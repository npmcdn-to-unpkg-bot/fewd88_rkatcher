window.Box=window.Box||{},Box.Timing=Box.Timing||{execution:[],scripts:{},events:{}},Box.Timing.scripts.uploader=(new Date).getTime(),Box.Timing.execution.push({name:"js/upload/upload_process.js",time:(new Date).getTime()});var Upload_Process=Base.extend({START:"start",PROGRESS:"progress",UPLOAD_COMPLETE:"upload_complete",CANCEL:"cancel",WAIT:"wait",RETRY:"retry",SLOW_UPLOAD_MESSAGE:"slow_upload_message",UPLOAD_HOST_UNREACHABLE:"upload_host_unreachable",TIMEOUT:"timeout",ERROR:"error",HEALTH_CHECK_TIMER_DELAY_MS:6e4,MAX_UPLOAD_FOR_ENTERPRISES:5368709120,show_comments_on_upload:!0,item:null,host_info:null,url_options:null,base_page_title:"",constructor:function(){this.init();var e=this;$j(function(){e.add_unload_handler()})},init:function(){this.browser=Box.Application.getService("browser"),this.ajax=Box.Application.getService("ajax"),this.upload_service=Box.Application.getService("upload-process"),this.popups_service=Box.Application.getService("popups"),this.notificationsService=Box.Application.getService("notifications"),this.startUploadRm="box_start_upload",this.folderUploadRm="box_create_subfolder_path",this.log_upload_event_url="/index.php?rm=box_upload_log_event",this.html5_upload_url=window.html5_upload_url,this.flash_upload_url=window.flash_upload_url,this.total_progress=0,this.total_size=0,this.files=[],this.files_left=[],this.files_to_show_in_confirmation=[],this.selected_files=[],this.upload_popup=null,this.start_time=0,this.request=null,this.uploading=-1,this.health_check_timer=0,this.progress_folder_id=-1,this.active_trigger=null,this.last_active_trigger=null,this.progress_showing=!1,this.progress_hidden=!1,this.ajax_dnd_dropzone=null,this.folder_id_to_item_index={},this.parent_folder_cache={}},current_folder_has_upload_permission:function(){return Canvas.get().current_folder.permissions.upload},has_items:function(){var e=Canvas.get().collections;return e&&e.length>0&&e[0].items?e[0].items.length>0:!1},get_type:function(){return"default"},add_unload_handler:function(){var e=this;window.onbeforeunload=function(t){if(e.files.length){var i=$t("Your upload will be canceled if you do this.","popup_myfiles_progress_es_navigate_away");return i}}},confirm_uploads:function(e){var t=this;e=e||{};var i=e.folder?e.folder:Canvas.get().current_folder;return e.upload_popup_already_exists?void(e.callback&&e.callback()):(e.file_id||e.file||(e.folder_id=Canvas.get().current_folder?Canvas.get().current_folder.id:"0"),e.on_popup_cancel=function(){$j.popup.close(),t.upload_popup=null,t.selected_files=[]},void(this.should_show_confirmation_popup(e.upload_type,i)?this.show_uploads_popup(e):this.submit_upload_from_popup({upload_folder_id:i.id,folder_upload_key:e.folder_upload_key})))},should_show_confirmation_popup:function(e,t){return"html5_folder_upload"!==e&&("default"===e||t.is_root_folder()||"hotkeys"===e)},show_uploads_popup:function(e){var t=this;e=$j.extend({},e),e.messages=e.messages||{},e.folder=e.folder||Item.find($j("#upload_folder_id").val())||Canvas.get().current_folder,e.linebreak=!0,e.title||(e.title=$t("Upload Files","js_popup_title_upload_files"));var i=[],o=e.folder,s={type:"box_upload_selector",label:$t("Selected files:","uploader_selected_files"),linebreak:!0,messages:e.messages,toggle_upload_button:function(e){var t=$j("#popup_upload_button");e?t.enable():t.disable()},upload_type:e.upload_type};i.push(s);var a={type:"boxFolderSelector",default_folder_id:o?o.typed_id:"d_0",default_folder_name:o&&o.name?$.box.escapeHTML(o.name):$t("All Files","box_all_files"),linebreak:!0,label:$t("Upload to:","upload_popup_upload_to_label")+" ",id:"upload_folder"};i.push(a);var r=e.on_popup_cancel;i.push({type:"buttons",items:{ok:{value:$t("Upload","js_popup_button_upload"),click:function(){var e=$j("#upload_folder_id").val();$j.popup.close(function(){Upload_Process.get().submit_upload_from_popup({upload_folder_id:e})})},id:"popup_upload_button"},cancel:{value:$t("Cancel","js_popup_button_cancel"),click:function(){r()}}},notSubmit:!0});var n={favicon_class:"upload",required:!0},l=function(){t.upload_popup=null};this.upload_popup=$j.popup.form(e.title,i,n,l)},show_upload_new_version_popup:function(e){var t=this;if(e=e||{},e.file=e.file||Canvas.get().target_item,!e.file)return function(){};var i=e.file;e.linebreak=!0,e.title||(e.title=$t("Upload New Version","js_popup_title_upload_new_version"));var o=e.on_upload_success,s=Box.Application.getService("thumbnail"),a=[],r=Box.Application.getService("templates");r=r&&r.getTemplateFragment("current_file_version_template",{fileTypeIcon:s.getFileTypeIcon(i.name,"32"),fileName:$.box.escapeHTML(i.name),message:this._create_upload_new_version_popup_message(i),fileSize:i.size}),a.push({type:"html",data:r});var n=$("#popup_upload_button"),l={type:"box_simple_file_picker",linebreak:!0,file:i,toggle_upload_button:function(e){e?n.enable():n.disable()}};a.push(l);var _=e.on_popup_cancel,d=function(t,s,a){$j.popup.close(function(){i.previous_version_file_name=i.name,Upload_Process.get().submit_upload_from_popup({file:i,new_file:a||null,callback:o,show_toaster:e.show_toaster})})};a.push({type:"buttons",items:{ok:{value:e.ok_text||$t("Upload","js_popup_button_upload"),click:e.click_handler||d,id:"popup_upload_button"},cancel:{value:$t("Cancel","js_popup_button_cancel"),click:function(){$j.popup.close(),Upload_Process.get().selected_files=[],"function"==typeof _&&_()}}},notSubmit:!0});var u={favicon_class:"upload",required:!0},p=e.callback||function(){t.upload_popup=null,t.selected_files=[],"function"==typeof e.on_popup_close&&e.on_popup_close()};return this.upload_popup=$j.popup.form(e.title,a,u,p),n.disable(),d},_create_upload_new_version_popup_message:function(e){var t="",i=$.box.escapeHTML(e.created_by);t=e.use_created?e.user_is_owner?$t("Created by You","created_by_you"):$t("Created by %1","created_by_username",i):e.user_is_owner?$t("Updated by You","updated_by_you"):$t("Updated by %1","updated_by_username",i);var o=Box.Application.getService("datetime"),s=o.FORMAT_TYPES.LONG_DATE,a=o.formatRelativeDateInUserTimezone(e.date,s),r=$.box.escapeHTML(a);return t+" â‹… "+r},popup_upload_java_open:function(e){var t=e?e:Canvas.get().current_folder,i=t.typed_id,o=t.collaborated||t.collaborations&&t.collaborations.length>1?!0:!1;if(this.browser.isIncompatibleChromeMacCombination())return void this.popups_service.alert($t("Google Chrome browser on Mac OS X does not currently support Java, which is required for the Folder Uploader. To use the Folder Uploader, please use another browser.","js_incompatible_mac_chrome_warning"));if(e&&!o&&t.folder){var s=t.folder;s&&(o=s.collaborated||s.collaborations&&s.collaborations.length>1?!0:!1)}{var a,r=388,n=o?382:362,l=window.screen.width/2-r/2,_=window.screen.height/2-n/2;$j("#upload_folder_id")}a=i?i:Canvas.get().current_folder.typed_id;var d="/index.php?rm=box_v2_java_popup&folder_id=";d+=a,o&&!t.is_root_folder()&&(d+="&folder_is_collab=1"),this.browser.isIncompatibleSafariMacCombination()&&(d+="&is_problematic_mac_os=1");var u=Box.Application.getService("url");u.openWindow(d,"dd_upload","height="+n+", width="+r+", left="+l+", top="+_+", status=no, toolbar=no, menubar=no, location=no, scrollbars=no, resizeable=no"),$j.popup.close()},add_trigger:function(e){var t=Box.Application.getService("filepicker"),i=null;return e.isAjaxUpload="function"==typeof this.get_type&&"default"===this.get_type(),i=t.create(e.element,e),i.init(),i},submit_upload_from_popup:function(e){e=e||{};var t,i,o="0",s=null,a=null,r=null,n=null,l=null,_=0,d=0,u=!1,p=[],h=!1,c=Box.Application.getService("html5-upload");if(Canvas.get().selection.unselect_all(),e.upload_folder_id?o=e.upload_folder_id:e.file&&e.file.folder?(s=e.file.folder,o=s.id,a=e.file.id):o=Canvas.get().current_folder?Canvas.get().current_folder.id:"0",o=o.toString(),/[fdltz]_\d+/.test(o)&&(o=o.substring(2)),s||(s=Item.find(o)),i=s?s.name:$t("All Files","box_all_files"),e.new_file)this.selected_files=[e.new_file];else if(0===this.selected_files.length)return!0;for(var f=0;f<this.selected_files.length;f++){if(r=this.selected_files[f].file,n=c.getWebkitFileData(r),l=null,_=0,d=0,u=!1,p=[],n?(l=n.name,d=n.lastModifiedDate,u=n.isFolder,p=n.relativeFolderPath):(l=this.get_file_name(r),_=this.get_created_date(r),d=this.get_last_modified_date(r),u=r.is_folder,p=r.relative_folder_path),t=new Upload_Process.Item({name:l,created_date:_,last_modified_date:d,size:this.get_file_size(r),progress:0,mime_type:r.type,file:r,description:this.selected_files[f].description,file_id:a,dropped:!1,callback:e.callback||this.selected_files[f].upload_callback,parent_folder:{id:o,name:i},is_folder:u,relative_folder_path:p,path_identifier:this.upload_service.getIdentifierPath(o.toString(),p),folder_upload_key:e.folder_upload_key}),h=h||u,this.upload_service.isItemUnsupportediWorkFile(t))return this.upload_service.showUnsupportediWorkFilePopup([t.name]),this.selected_files=[],this.upload_log_event("filepicker_click_event",{total_files:f,folder_upload:h}),this.upload_log_event("iwork_error",{}),!1;if(this.upload_service.isItemUnsupportedPackageFile(t))return this.upload_service.showUnsupportedPackageFilePopup([t.name]),this.selected_files=[],this.upload_log_event("filepicker_click_event",{total_files:f,folder_upload:h}),this.upload_log_event("unsupported_pkg_error",{}),!1;var m=this.is_item_too_large(s,t);if(m)return this.upload_service.showItemTooLargePopup(m,s),this.selected_files=[],this.upload_log_event("filepicker_click_event",{total_files:f,folder_upload:h}),!1;this.add_to_queue(t,e),this.upload_log_event("filepicker_click_event",{total_files:this.selected_files.length,folder_upload:h})}return this.update_progress(),this.selected_files=[],!0},check_for_upload_new_version:function(e){if(e.file_id)return e.item_to_replace=Item.find(e.file_id),"ok";if(e.parent_folder&&e.parent_folder.id!==Canvas.get().current_folder.id)return"ok";for(var t=this.upload_service.getItemPath(e),i=t.toLowerCase(),o=Canvas.get().collections[0],s=0;s<o.items.length;s++){var a=o.items[s],r=a.name?a.name.toLowerCase():"";if(a.id&&r==i){if(e.item_to_replace=a,a.lock&&a.lock.user_id!=Canvas.get().user.id)return this.popups_service.alert($t("A file with the name '%1' already exists in this folder and it is locked by %2","js_locked_file_with_same_name_message",e.name,a.lock.user_display_name)),"invalid";e.implicitly_uploading_new_version=!0;break}}return"ok"},cancel:function(e){var t;this.files_left.push(this.uploading);for(var i=0;i<this.files_left.length;i++)t=this.files[this.files_left[i]],this._replace_canceled_upload_with_original(t);this.reset(),Canvas.get().attach_events(),this.log_upload_event({event_type:this.CANCEL,upload_session_id:e})},cancel_all_uploads:function(e){var t=this;return e?(this.selected_files=[],this.cancel(),void t.clear_external_progress_indicators()):void this.popups_service.confirm($t("Are you sure you would like to cancel?  This will interrupt all uploads in progress.","js_toaster_cancel_all_uploads"),{onconfirm:function(){t.cancel_all_uploads(!0)}})},add_to_queue:function(e,t){var i=this.check_for_upload_new_version(e);"invalid"!=i&&(this.files.length||(this.start_time=(new Date).getTime()),this.progress_hidden=!1,this.total_size+=e.is_folder?0:e.size,this.files.push(e),this.files_left.push(this.files.length-1),Box.Application.broadcast("x-uploadstarted",{item:e}),this.start_new_uploads(t))},start_new_uploads:function(e){var t=this,i=Box.Application.getService("v5"),o=i.get("Toaster");if(this.files_left.length&&-1==this.uploading){if($j("#subheader div").show(),$j("#subheader").removeClass("subheader_new_empty"),this.uploading=this.files_left.shift(),"success"==this.files[this.uploading].status)return void this.start_new_uploads();(!$("html, body").hasClass("has_lightbox")||e&&e.show_toaster===!0)&&o.show({on_cancel_callback:function(){t.cancel_all_uploads(!1)}}),this.start_health_check_timer(),this.files[this.uploading].status="started";var s=this.files[this.uploading];this.most_recent_upload=s,this.update_progress();var a=s.relative_folder_path;this.browser.canFolderUpload()&&a&&a.length>0?this.upload_item_to_path(s):this.upload_file_to_account(s)}},upload_item_to_path:function(e){var t=e.path_identifier,i=this.parent_folder_cache,o=t&&t in i;o&&!e.is_folder?(e.parent_folder=i[t],this.upload_file_to_account(e)):o||this.create_folder_path_and_upload_item(e)},showUploadErrorNotification:function(e){e?this.notificationsService.error(e):(e=$t("There was an error with your upload, please try again.","generic_upload_error_message"),this.notificationsService.error(e,{action:{text:$t("More Info","more_info"),onclick:function(){Box.Application.getService("url").openWindow(Upload_Process.UPLOAD_TYPE_SUPPORT_LINK)}}}))},cancelUploads:function(){this.cancel(),this.clear_external_progress_indicators()},retryOrSkipFileUpload:function(e,t){e.retryCounter>0?(e.retryCounter--,this.retry_file()):(this.showUploadErrorNotification(t),this.skip_file(e))},retryFileOrCancelAllUploads:function(e,t){e.retryCounter>0?(e.retryCounter--,this.retry_file()):(this.showUploadErrorNotification(t),this.cancelUploads())},_handleStartFolderUploadError:function(e,t){var i=this.find_item_index(e);e.is_folder?(this.showUploadErrorNotification(t),this.skip_folder(e),i===this.uploading&&this.start_new_upload_or_finish()):this.retryOrSkipFileUpload(e,t)},create_folder_path_and_upload_item:function(e){var t,i=this;t={relative_folder_path:e.relative_folder_path,parent_folder_id:e.parent_folder?e.parent_folder.id:"",upload_type:this.get_type()},null!=this.host_info&&(t.hosts_to_exclude=this.upload_hosts_to_exclude()),this.ajax.post(this.folderUploadRm,t).then(function(e){var t=e.data,o=i.uploading,s=i.files[o];if(s)if(t.status===Upload_Process.RET_SUCCESS_STATUS){var a=t.subfolder_id;s.is_folder?(s.file_id=a,s.item&&s.item.set_params({id:a,typed_id:t.subfolder_typed_id}),s.parent_folder={name:t.parent_folder_name,id:t.parent_folder_id,folder_found:!0},i.folder_id_to_item_index[a]={index:o,parent_folder_id:t.parent_folder_id},i.parent_folder_cache[s.path_identifier]={name:s.name,id:a,folder_found:!0},i.handle_upload_finished()):(s.parent_folder={name:t.subfolder_name,id:a,folder_found:!0},i.upload_file_to_account(s))}else i._handleStartFolderUploadError(s,t.message)},function(){var e=i.files[i.uploading];e&&(e.is_folder?(i.showUploadErrorNotification(""),i.cancelUploads()):i.retryFileOrCancelAllUploads(e,""))})},upload_file_to_account:function(e){var t=this.is_file_api_supported()&&Box.Application.getService("uploads-sha1-worker").isInlineWorkerSupported(),i={name:e.name,created_date:e.created_date,last_modified_date:e.last_modified_date,size:e.size,upload_type:this.get_type(),folder_id:e.parent_folder?e.parent_folder.id:"",client_supports_multiput:t?1:0};null!==e.file_id&&(i.file_id=e.file_id),null!=this.host_info&&(i.hosts_to_exclude=this.upload_hosts_to_exclude());var o=this;this.ajax.post(this.startUploadRm,i).then(function(e){var t=e.data,i=o.files[o.uploading];if(i)if(t.status===Upload_Process.RET_SUCCESS_STATUS){var s=t.upload_session_id,a=t.url_options.host_url;if(i.upload_session_id=s,i.use_multiput=!!t.url_options.multiput_upload_url&&!!t.api_token,i.use_multiput){i.token=t.api_token.access_token;var r=t.url_options.multiput_upload_url+"/"+s;i.item_to_replace&&(r=r.replace("/files","/files/"+i.item_to_replace.id)),i.multiput_start_session_url=r,i.part_upload_url=a+"api/2.1/files/upload-session/"+s,i.commit_url=a+"api/2.1/files/upload-session/"+s+"/commit",i.abort_url=a+"api/2.1/files/upload-session/"+s}o.upload_method=o.upload,t.feedback_loop?o.perform_potential_reachability_test_and_upload(t):o.upload_method()}else o.retryOrSkipFileUpload(i,"")},function(){var e=o.files[o.uploading];e&&o.retryFileOrCancelAllUploads(e,"")})},is_file_api_supported:function(){return!this.use_form()&&"undefined"!=typeof Blob&&!!Blob.prototype.slice},use_form:function(){return!0},perform_potential_reachability_test_and_upload:function(e){this.url_options=e.url_options;var t=!this.browser.isIE()||this.browser.isMinBrowser("Explorer",8);e.reachability_test&&1==this.url_options.fast_upload&&t?this.determine_reachable_upload_hosts_and_upload():this.set_upload_urls_and_upload()},handle_upload_progress:function(e){var t,i=this.files[this.uploading];e=parseInt(e),this.start_health_check_timer(),-1!=this.uploading&&(e>i.size&&(e=i.size),t=e-i.progress,this.total_progress+=t,this.upload_service.updateFolderProgress(i.parent_folder.id,t),i.progress=e,this.update_progress())},handle_upload_finished:function(){var e,t,i,o,s=this;this.kill_current_health_check_timer(),-1!=this.uploading&&(e=this.files[this.uploading],i=!this.files_left.length,i&&s.clear_external_progress_indicators(3e3),e.is_folder?(this.upload_service.updateFolderProgress(e.parent_folder.id,e.size),e.progress=0):(this.total_progress+=e.size-e.progress,e.progress=e.size),this.update_progress(i),e.status="success",e.callback&&window.setTimeout(e.callback,3e3),this.uploading=-1,i?(t=this.files,this.reset(),this.zero_state_upload_success()):this.start_new_uploads(),o=Canvas.get().current_folder,o&&o.typed_id&&o.id!=e.parent_folder.id?i&&t&&this.upload_service.handleAllItemsUploadFinished(t):this.upload_service.handleItemUploadFinished(e,i))},_handle_reload_updated_file_callback:function(e){var t=Box.Application,i=t.getService("notifications"),o=Item.find(e.file_id);if(o){o.missing_thumbnails&&Item.add_to_items_with_missing_thumbnails(o);var s=o.name,a="",r=o.previous_version_file_name;if(r&&r!=s){var n=r;a=$t("You have uploaded a new version of %1 and changed the name to %2.","js_upload_new_version_item_name_and_rename",n,s),o.previous_version_file_name=null}else a=$t("You have uploaded a new version of %1.","js_upload_new_version_item_name",s);i.confirm(a)}},handle_file_loaded:function(){},getUploadErrorMessage:function(e){var t="";switch(e){case"rate_limit":t=$t("Upload rate limit exceeded. Please try again later.","upload_rate_limit_exceeded_try_again");break;case"bad_request":t=$t("An error occurred with the upload. Please refresh the page and try again.","upload_bad_request_try_again_error_message");break;case"request_entity_too_large":t=$t("The file you are uploading is too large. If you continue to encounter this error, please use the Folder Uploader tool.","upload_request_too_large_error_message");break;case"queue_limit_exceeded":t=$t("Please use the Folder Uploader tool to upload more than 100 files at a time.","queue_limit_exceeded_message");break;case"zero_byte_file":t=$t("One or more of your files is an unsupported size. Please update your browser and try again.","zero_byte_file_message")}return t},handle_upload_error:function(e){var t=this.getUploadErrorMessage(e);if(t)this.popups_service.alert(t),this.cancel(),this.clear_external_progress_indicators();else{var i=this.files[this.uploading];i&&(this.popups_service.confirm($t("An unknown error occurred with the upload. '%1' was skipped.","upload_error_item_name",i.name),{title:$t("Upload Error","upload_error"),cancelText:$t("Close","close"),confirmText:$t("More Info","more_info"),onconfirm:function(){return Box.Application.getService("url").openWindow(Upload_Process.UPLOAD_TYPE_SUPPORT_LINK),!1}}),this.skip_file(i))}},show_confirmation:function(){var e={},t=this.files_to_show_in_confirmation;for(var i in t){var o=t[i];e[o.typed_id||o.upload_id]={id:o.id||o.upload_id,name:o.name,type:o.type,errors:o.errors}}Box_Confirmation_Message_Builder.get().show_notification_for_new_items(e),this.files_to_show_in_confirmation=[],Canvas.get().attach_events()},handle_file_aborted:function(){},get_url:function(){var e="";return e=this.use_form()?this.flash_upload_url:this.html5_upload_url,this.append_common_url_parameters(e)},append_common_url_parameters:function(e){var t=Box.Application.getService("url"),i=this.files[this.uploading];return e+=(-1==e.indexOf("?")?"?":"&")+"folder_id="+i.parent_folder.id,e+="&upload_type="+i.upload_type,i.description&&(e+="&description="+encodeURIComponent(i.description)),i.file_id?(Tombstone.marker("upload_process.js::get_url","2014-02-23","I do not think currently_uploading_file.file_id is set."),e+="&file_id="+i.file_id):i.item&&i.item.id?e+="&file_id="+i.item.id:i.item_to_replace&&i.item_to_replace.id&&(e+="&file_id="+i.item_to_replace.id),i.upload_session_id&&(e+="&upload_session_id="+i.upload_session_id),i.last_modified_date&&(e+="&last_modified_date="+encodeURIComponent(i.last_modified_date)),e=t.addAdditionalContext(e),e+="&realtime_subscriber_id="+Realtime_Notification.subscriber_id,e+="&request_token="+request_token},update_progress:function(e){var t,i,o,s,a,r=Box.Application.getService("strings"),n=this.files[this.uploading],l=!1;-1!=this.uploading&&(this.log_progress(),this.update_inline_progress(),e&&(this.total_progress=this.total_size),t=n.parent_folder,i="Box",t.name&&(i=r.getFastShortString(t.name,130)),l=n.relative_folder_path.length&&!t.folder_found,o=l?n.is_folder?this.get_translated_message("toaster_simple_creating_folder_message",{first:n.name}):this.get_translated_message("toaster_simple_uploading_message",{first:this.uploading+1,second:this.files.length}):n.is_folder?this.get_translated_message("toaster_creating_folder_message",{first:n.name,second:i}):this.get_translated_message("toaster_uploading_message",{first:this.uploading+1,second:this.files.length,third:i}),s=this.total_size?this.total_progress/this.total_size*100:0,a=Toaster.get(),a.set_message($.box.escapeHTML(o)),a.set_progress(s),e&&a.toggle_cancel_link(!1),this.update_title_progress(s))},get_translated_message:function(e,t){switch(e){case"toaster_simple_creating_folder_message":return $t("Creating folder %1","toaster_simple_creating_folder_message",t.first);case"toaster_simple_uploading_message":return $t("Uploading %1 of %2 file(s)","toaster_simple_uploading_message",t.first,t.second);case"toaster_creating_folder_message":return $t("Creating folder %1 in %2","toaster_creating_folder_message",t.first,t.second);case"toaster_uploading_message":return $t("Uploading %1 of %2 file(s) to %3","toaster_uploading_message",t.first,t.second,t.third)}},update_title_progress:function(e){var t,i,o=Box.Application.getService("v5"),s=o.get("document");(0===this.base_page_title.length||this.base_page_title!=s.title.substring(s.title.length-this.base_page_title.length))&&(this.base_page_title=s.title),0!==this.base_page_title.length&&(t=Math.floor(e),i=$t("(%1% of file %2 of %3)","title_uploading_prefix",t,this.uploading+1,this.files.length),s.title=i+" "+this.base_page_title),100==t&&this.clear_title_progress(3e3)},clear_title_progress:function(e){var t=Box.Application.getService("v5"),i=t.get("document"),o=this.base_page_title;e&&"number"==typeof e||(e=0),window.setTimeout(function(){i.title=o},e)},clear_external_progress_indicators:function(e){Toaster.get().hide(e),this.clear_title_progress(e)},log_progress:function(e){if(e=e||{},progress_interval){var t=(new Date).getTime(),i=1e3*progress_interval;if(e.force_update||!this.last_time_progress_was_logged||this.last_time_progress_was_logged+i<t){this.last_time_progress_was_logged=t;var o=this.files[this.uploading],s={event_type:this.PROGRESS,bytes_uploaded:o.progress};e.size&&(s.size=e.size),this.log_upload_event(s)}}},update_inline_progress:function(){if(Box.Application.getService("v5").get("Canvas").current_folder)for(var e=0;e<this.files.length;e++)Box.Application.broadcast("x-uploadupdate",{item:this.files[e],isVisible:!this.should_placeholder_be_invisible(this.files[e])})},should_placeholder_be_invisible:function(e){var t,i,o=this.is_item_in_current_folder(e),s="success"==e.status&&!e.is_folder,a=e.is_folder&&(e.size&&e.size<=e.progress||"completed"===e.status);return t=e.is_folder&&e.relative_folder_path.length>1,i=!e.is_folder&&e.relative_folder_path.length>0,!o||s||a||!e.parent_folder.folder_found&&(t||i)},remove_folder_placeholder_from_ui:function(e){"success"===e.status||"completed"===e.status?this.refresh_folder_after_upload(e):this._remove_placeholder_from_ui(e)},remove_item_placeholder:function(e){return this.should_placeholder_be_invisible(e)?void 0:e.is_folder?void this.remove_folder_placeholder_from_ui(e):void("success"!==e.status&&this._remove_placeholder_from_ui(e))},reset:function(){this.kill_current_health_check_timer();for(var e=0;e<this.files.length;e++)this.files[e].item&&this.remove_item_placeholder(this.files[e]);this.total_progress=0,this.total_size=0,this.files=[],this.files_left=[],this.selected_files=[],this.upload_popup=null,this.start_time=0,this.request=null,this.uploading=-1,this.folder_id_to_item_index={},this.parent_folder_cache={}},start_health_check_timer:function(){var e=this;this.kill_current_health_check_timer(),this.health_check_timer=window.setTimeout(function(){e.show_slow_upload_popup()},this.HEALTH_CHECK_TIMER_DELAY_MS)},kill_current_health_check_timer:function(){this.health_check_timer&&(window.clearTimeout(this.health_check_timer),this.health_check_timer=0)},show_slow_upload_popup:function(){var e,t=this,i=this.uploading,o=this.files[this.uploading].upload_session_id,s={value:$t("Wait","js_popup_button_wait"),click:function(e,i){$j.popup.close(),t.start_health_check_timer(),t.log_upload_event({event_type:t.WAIT,upload_session_id:o})}},a={value:$t("Retry File","js_popup_button_retry_file"),click:function(e,o){$j.popup.close(),t.uploading==i&&t.retry_file()}},r={value:$t("Skip File","js_popup_button_skip_file"),click:function(e,s){$j.popup.close(),t.uploading==i&&(t.log_upload_event({event_type:t.CANCEL,upload_session_id:o}),t.skip_file())}},n={value:$t("Cancel","js_popup_button_cancel"),click:function(e,i){$j.popup.close(),t.cancel()}};e=this.files.length>1?{wait:s,retry_file:a,skip_file:r}:{wait:s,retry_file:a,cancel:n},Box.Application.getService("v5popups-postload").showSlowUploadPopup(e),this.log_upload_event({event_type:this.SLOW_UPLOAD_MESSAGE})},retry_file:function(){this.kill_current_health_check_timer(),this.request&&(this.request.abort(),this.request=null),this.log_upload_event({event_type:this.RETRY,upload_session_id:this.files[this.uploading].upload_session_id}),this.total_progress-=this.files[this.uploading].progress,this.files[this.uploading].progress=0,this.files_left.unshift(this.uploading),this.uploading=-1,this.start_new_uploads()},find_item_index:function(e){var t=-1;return e&&(t=$.inArray(e,this.files)),t},erase_index_from_files_list:function(e){for(var t=-1,i=0;i<this.files_left.length;i++)this.files_left[i]===e?t=i:this.files_left[i]>=e&&this.files_left[i]--;-1!==t&&this.files_left.splice(t,1),this.files.splice(e,1)},start_new_upload_or_finish:function(){this.uploading=-1,this.files_left.length?this.start_new_uploads():(this.reset(),this.clear_external_progress_indicators())},skip_folder:function(e){this.kill_current_health_check_timer();var t,i=this.files.length-1;if(e.folder_upload_key){for(;i>=0;)t=this.files[i],t&&t.folder_upload_key===e.folder_upload_key&&t!==e&&this.remove_file(t),i--;e.size=e.progress;var o=e?this.find_item_index(e):this.uploading;-1===o||o===this.uploading||o>=this.files.length||(""===this.files[o].status?(this.erase_index_from_files_list(o),this.remove_folder_placeholder_from_ui(e)):"success"===this.files[o].status&&(e.status="completed",this.remove_folder_placeholder_from_ui(e),this.start_new_upload_or_finish()))}},skip_file:function(e){var t=e?this.find_item_index(e):this.uploading;this.remove_file(e),t===this.uploading&&this.start_new_upload_or_finish()},remove_file:function(e){this.kill_current_health_check_timer();var t=e?this.find_item_index(e):this.uploading;if(!(-1==t||t>=this.files.length||"success"==this.files[t].status)){var i=this.files[t];box&&(i.file_id||i.implicitly_uploading_new_version)?this._replace_canceled_upload_with_original(i):this.remove_item_placeholder(i),this.erase_index_from_files_list(t),this.total_size-=i.size,t==this.uploading&&(this.request&&(this.request.abort(),this.request=null),this.total_progress-=i.progress,this.log_upload_event({event_type:this.CANCEL,upload_session_id:i.upload_session_id})),Box.Application.broadcast("x-uploadcanceled")}},get_max_file_size:function(){return window.file_size_upload_limit},report_iwork_files:function(e){e.length&&this.upload_service.showUnsupportediWorkFilePopup(e)},report_unsupported_package_files:function(e){e.length&&this.upload_service.showUnsupportedPackageFilePopup(e)},report_ambiguous_folder_or_zero_byte_files:function(e){var t;e&&e.length&&(t=$t("We're sorry, your browser doesn't support uploading folders [or 0 byte files] using drag-and-drop. Skipping the following items: %1.","error_ambiguous_upload",e.join(", ")),this.show_uploads_error_popup(t))},report_folder_files:function(e){var t,i;e&&e.length&&(t=$t("Folder Upload Error","js_popup_folder_upload_error"),i=$t("Sorry, drag-and-drop uploads don't currently include folders. The following are considered folders and will be skipped: %1.","js_popup_error_folder_upload_html5_no_dnd",e.join(", ")),this.show_uploads_error_popup(i,t))},show_uploads_error_popup:function(e,t){var i="/index.php?rm=box_sync_can_use_sync",o=$t("Upload Error","popup_upload_error_title");t="undefined"!=typeof t?t:o,$j.getJSON(i,{user_id:Canvas.get().user.id},function(i){var o="",s="</a>",a='<a href="#" class="bulk_upload_link">',r="<p>",n="</p>";o=i.result&&i.can_use_sync?$t("To complete your upload, please use %1Box Sync%2 or our %3Folder Uploader%4 tool.","error_ambiguous_recommendation_with_sync",'<a href="/settings/sync">',s,a,s):$t("To complete your upload, please use our %1Folder Uploader%2 tool.","error_ambiguous_recommendation",a,s);var l=r+e+n+r+o+n;$j.popup.alert(t,l,{click_handlers:{".bulk_upload_link":function(){return Upload_Process.get().popup_upload_java_open(),!1}}})})},log_upload_event:function(e){if(e=e||{},!e.upload_session_id){var t=this.files[this.uploading];t&&(e.upload_session_id=t.upload_session_id)}e.upload_session_id&&$j.postJSON(this.log_upload_event_url,e,function(e){})},get_current_folder_from_registry_or_server:function(e){var t,i,o,s;return t=Item.find(e.parent_folder.id),t||(t={id:e.parent_folder.id}),(null==t.max_upload_size||"undefined"==typeof t.max_upload_size)&&(i="/index.php?rm=box_ajax_upload_folder_info",s=t.id>0?{folder_id:t.id}:{file_id:e.file_id},o=this,jQuery.ajax({type:"GET",url:i,data:s,dataType:"json",async:!1,success:function(i){i&&(e.parent_folder=t=Item.find_or_create(i.folder))}})),t},is_item_too_large:function(e,t){return t.is_folder?this.is_item_too_large_for_destination_folder(e,t):this.is_file_too_large(t)},is_size_greater_than_max_upload_size:function(e){return e>this.get_max_file_size()},is_size_greater_than_free_space_of_folder_owner:function(e,t){return t>e.free_space_amount},is_size_greater_than_max_upload_size_for_folder:function(e,t){return t>e.max_upload_size},show_folder_free_space_limitation_popup:function(e){var t,i,o,s,a,r=Box.Application.getService("strings");if(e.user_is_owner)if(t=Canvas.get().user,a=r.getHumanReadableSize(e.free_space_amount),i=$t("Upload is larger than your total free space (%1).","popup_upload_larger_than_free_space",a),o=$t("Please contact your administrator with any questions.","popup_upload_please_contact_admin_with_questions"),"0"==t.enterprise_id||t.is_master)if(t.is_free_user){var n=Box.Application.getService("url"),l=Box.Application.getService("popups-amsterdam"),_=n.getGcmCompatibleRm("storage_paywall_popup");l.open(_,{data:{remainingSpace:a}})}else this.popups_service.alert(i);else this.popups_service.alert(i+" "+o);else s=$t("Upload is larger than the folder owner's total free space (%1).","popup_upload_larger_than_free_space_user_not_owner",r.getHumanReadableSize(e.free_space_amount)),this.popups_service.alert(s)},show_folder_upload_size_limitation_popup:function(e){if(e.user_is_owner)if(e.max_upload_size<this.MAX_UPLOAD_FOR_ENTERPRISES){var t=Canvas.get().user;if(t.is_free_user){var i=Box.Application.getService("url"),o=Box.Application.getService("popups-amsterdam"),s=i.getGcmCompatibleRm("large_file_paywall_popup");o.open(s)}else{
var a=Box.Application.getService("v5popups");a.showUpgradePopup("larger_file")}}else this.show_maximum_upload_popup(this.MAX_UPLOAD_FOR_ENTERPRISES);else this.show_file_too_large_for_enterprise_message(e)},show_file_too_large_for_enterprise_message:function(e){var t=Box.Application.getService("strings"),i=$t("Upload is too large. The folder owner will need to upgrade their Box account to upload files larger than %1","popup_myfiles_upload_js_upgrade_size_limt_non_owner",t.getHumanReadableSize(e.max_upload_size));this.popups_service.alert(i)},get_item_size:function(e){var t=e.size||this.get_file_size(e.file,e.dropped);return parseInt(t)},show_folder_not_found_popup:function(){this.popups_service.alert($t("Sorry, there was an error in locating the folder","popup_upload_error_current_folder"))},is_item_too_large_for_destination_folder:function(e,t){var i=this.upload_service.ERROR_TYPES,o=this.get_item_size(t);return e?this.is_size_greater_than_free_space_of_folder_owner(e,o)?i.LARGER_THAN_FOLDER:!1:i.FOLDER_NOT_FOUND},is_file_too_large:function(e){var t,i=this.upload_service.ERROR_TYPES,o=this.get_item_size(e);if(this.is_size_greater_than_max_upload_size(o))return i.LARGER_THAN_MAX_SIZE;if(t=this.get_current_folder_from_registry_or_server(e),!t)return i.FOLDER_NOT_FOUND;if(this.is_size_greater_than_free_space_of_folder_owner(t,o))return i.LARGER_THAN_FOLDER;if(this.is_size_greater_than_max_upload_size_for_folder(t,o))return i.LARGER_THAN_FOLDER_MAX_SIZE;var s=Box.Application.getService("upload-process");return s.isItemTooLargeForIE(e)?(s.showIELargeItemError(),!0):!1},show_maximum_upload_popup:function(e){var t=Box.Application.getService("strings");this.popups_service.alert($t("Sorry, Box does not allow uploads larger than  %1","popup_upload_max_upload_size",t.getHumanReadableSize(e)))},show_no_upload_permission_popup:function(){this.popups_service.alert($t("You do not have permission to upload to this folder.  Please contact the folder owner about changing your role in this folder.","no_upload_permission_message_long"))},are_too_many_files_selected:function(e){return e.length>Upload_Process.MAX_UPLOAD_COUNT_NON_BULK},show_too_many_files_popup:function(){this.upload_service.showTooManyFilesPopup()},get_selected_file:function(e){return this.selected_files[e]},set_show_comments_on_upload:function(e){this.show_comments_on_upload=e?!0:!1},_replace_canceled_upload_with_original:function(e){var t,i,o=e.$item_to_replace;return o?(t=e.id,i=$("#upl_"+t),i.replaceWith(o),this._replace_canceled_item_in_collection(e),!0):!1},_replace_canceled_item_in_collection:function(e){var t=Canvas.get().collections[0];t.add(e.item_to_replace,e.item.upload_id)},_remove_placeholder_from_ui:function(e){var t=this._replace_canceled_upload_with_original(e);t||(Canvas.get().collections[0].remove(e.item),$j("#upl_"+e.id).remove())},is_item_in_current_folder:function(e){var t=Box.Application.getService("nav-state"),i=t.get();return""+e.parent_folder.id==""+i.id},refresh_folder_after_upload:function(e){var t=this,i=e.item;i.refresh(function(i,o,s){var a=t.is_item_in_current_folder(e);Box.Application.broadcast("x-newversionupload",{item:e,html:o,skipRender:s,isVisible:a})},{on_error_callback:function(){t.remove_item_placeholder(e),t.cancel(),t.clear_external_progress_indicators()}})},refresh_file_after_upload:function(e,t){var i=this,o=e.item,s=!!e.file_id;o.refresh(function(o,a,r){var n=i.is_item_in_current_folder(e),l=Box.Application.getGlobal("Canvas");Box.Application.broadcast("x-newversionupload",{item:e,html:a,skipRender:r,isVisible:n}),s?i._handle_reload_updated_file_callback(e):(i.files_to_show_in_confirmation.push(o),t&&i.show_confirmation());var _=l.get().current_folder;_&&_.refresh(function(e){_.raw_size=e.raw_size})},{upload_session_id:e.upload_session_id,on_error_callback:function(t){i.show_confirmation(),i.remove_item_placeholder(e),i.cancel(),i.clear_external_progress_indicators(),"locked"==t?(i.popups_service.alert($t('"%1" has been recently locked. Please request the person who locked the file to unlock it.',"js_popup_file_recently_locked",e.name)),e.item_to_replace.refresh()):i.popups_service.alert($t("There was a problem with your upload request. Please try again.","upload_generic_error"))}})},set_host_value:function(e,t,i){var o=Box.Application.getService("cookies");if(!this.host_info){var s=o.get("host_info");this.host_info=s?JSON.parse(s):null}this.host_info||(this.host_info={}),this.host_info[e]||(this.host_info[e]={}),this.host_info[e][t]=i;var a=JSON.stringify(this.host_info);o.set("host_info",a,(new Date).getTime()+6048e5)},get_host_value:function(e,t){var i=Box.Application.getService("cookies");if(!this.host_info){var o=i.get("host_info");this.host_info=o?JSON.parse(o):null}return this.host_info&&this.host_info[e]&&this.host_info[e][t]?this.host_info[e][t]:null},set_upload_urls_and_upload:function(){this.url_options&&this.url_options.html5_upload_url&&this.url_options.flash_upload_url&&(this.html5_upload_url=this.url_options.html5_upload_url,this.flash_upload_url=this.url_options.flash_upload_url),this.upload_method()},upload_hosts_to_exclude:function(){var e=[],t=this.url_options.external_ip;for(var i in this.host_info[t]){var o=this.host_info[t][i];0>o&&e.push(i)}return e},get_new_url_options_and_upload:function(){var e=this,t="/index.php?rm=box_upload_options",i=this.upload_hosts_to_exclude(),o=$j.box.formatQuery({hosts_to_exclude:i});$j.postJSON(t,o,function(t){t&&t.url_options&&t.url_options.host_url?(e.url_options=t.url_options,e.set_upload_urls_and_upload()):e.upload_method()})},_handle_post_success_and_upload:function(e){var t=this.url_options,i=t.external_ip,o=t.host_url,s=Box.Application.getService("datetime");"string"==typeof e&&"\n"===e.substring(0,1)?(this.set_host_value(i,o,s.getCurrentTimestampInSeconds()),this.set_upload_urls_and_upload()):(this.set_host_value(i,o,-1*s.getCurrentTimestampInSeconds()),this.get_new_url_options_and_upload())},_handle_post_error_and_upload:function(){var e=this.url_options.external_ip,t=this.url_options.host_url;this.set_host_value(e,t,-1*Box.Application.getService("datetime").getCurrentTimestampInSeconds()),this.get_new_url_options_and_upload()},_handle_post_timeout_and_upload:function(){this._handle_post_error_and_upload()},upload_test_and_upload:function(){var e=this,t=this.url_options.html5_upload_url+"?reachability_test=run",i=this.url_options.timeout_ms;if(this.browser.isMinBrowser("Explorer",8)&&window.XDomainRequest){var o=new XDomainRequest;o.onload=function(){e._handle_post_success_and_upload(o.responseText)},o.onerror=function(){e._handle_post_error_and_upload()},o.ontimeout=function(){e._handle_post_timeout_and_upload()},o.onprogress=function(){},o.timeout=i,o.open("post",t),o.send()}else $j.ajax({type:"POST",timeout:i,url:t,data:"reachability_file=test_file_data",success:function(t){e._handle_post_success_and_upload(t)},error:function(){e._handle_post_error_and_upload()},beforeSend:function(e,t){e.setRequestHeader("X-File-Name","reachability_pseudofile.txt"),e.setRequestHeader("X-File-Size","1234")},xhrFields:{withCredentials:!0}})},determine_reachable_upload_hosts_and_upload:function(){if(this.url_options){var e=this.url_options.host_url,t=this.url_options.retest_seconds,i=this.url_options.external_ip,o=this.get_host_value(i,e);!o||Math.abs(o)<Box.Application.getService("datetime").getCurrentTimestampInSeconds()-t?this.upload_test_and_upload():0>o?this.get_new_url_options_and_upload():this.set_upload_urls_and_upload()}else this.upload_method()},java_upload_completed:function(e,t){var i=null;(e||t)&&(i=$t("The Folder Uploader successfully added %1 file(s) and %2 folder(s)","bulk_upload_success",e,t)),i&&(box.after_load_callback=function(){Box.Application.getService("notifications").confirm(i)}),Box.Application.navigate("",{},{no_loading:!0})},zero_state_upload_success:function(){this.ajax_dnd_dropzone&&(this.ajax_dnd_dropzone=$j("#item-list"))},upload_log_event:function(e,t){this.upload_service.logUploadEvent(e,t)},get_static_item:function(e){return new Upload_Process.Item(e)}},{MAX_UPLOAD_COUNT_NON_BULK:100,BYTES_IN_MEGABYTE:1048576,BYTES_IN_GIGABYTE:1073741824,MAX_FILE_SIZE_SUPPORT_LINK:"https://support.box.com/hc/en-us/articles/200520238-What-s-the-maximum-file-size-I-can-upload",UPLOAD_TYPE_SUPPORT_LINK:"https://support.box.com/hc/en-us/articles/200520138-How-do-I-upload-files-to-Box-",RETRY_COUNT:1,Item:function(e){this.name=e.name||"",this.created_date=e.created_date||0,this.last_modified_date=e.last_modified_date||0,this.size=e.size||0,this.progress=e.progress||0,this.mime_type=e.mime_type||"",this.status=e.status||"",this.blob=e.blob||"",this.file=e.file||"",this.retryCounter=Upload_Process.RETRY_COUNT,this.parent_folder=e.parent_folder||{},this.description=e.description||"",this.file_id=e.file_id,this.dropped=e.dropped,this.upload_type=e.upload_type||"",this.callback=e.callback,this.id=Upload_Process.next_id,Upload_Process.next_id++,this.upload_session_id=e.upload_session_id||null,this.path_identifier=e.path_identifier||"",this.relative_folder_path=e.relative_folder_path||[],this.is_folder=e.is_folder||!1,this.folder_upload_key=e.folder_upload_key||""},next_id:0,get:function(){return Upload_Process.__instance||(Upload_Process.__instance=Upload_Process.create_instance()),Upload_Process.__instance},create_instance:function(){var e=Box.Application.getService("browser");return window.force_flash_upload?new Upload_Process_Flash:e.canUseHtml5Dnd()?new Upload_Process_HTML5_DND:e.canUseHtml5()?new Upload_Process_HTML5:e.canUseFlash()?new Upload_Process_Flash:new Upload_Process},RET_SUCCESS_STATUS:"success",RET_ERROR_STATUS:"error"});Box.Timing.execution.push({name:"js/upload/html5.js",time:(new Date).getTime()});var Upload_Process_HTML5=Upload_Process.extend({MULTIPUT_THREADS:3,MULTIPUT_NUM_TRIES:3,MULTIPUT_REQUEST_TIMEOUT:6e4,PART_STATE_NOT_STARTED:0,PART_STATE_IN_PROGRESS:1,PART_STATE_UPLOADED:2,PART_STATE_CANCELLED:3,constructor:function(){this.base()},get_type:function(){return"html5"},handle_change:function(e,t){var i,o,s,a,r,n=0,l=e.files;if(this.upload_popup||(this.selected_files=[]),!e.webkitdirectory&&this.are_too_many_files_selected(l))return void this.show_too_many_files_popup();for(i=0;i<l.length;i++){for(s=l[i].webkitRelativePath||l[i].name,o=0;o<this.selected_files.length;o++)if(a=this.selected_files[o].file.webkitRelativePath||this.selected_files[o].file.name,s===a){n-=this.selected_files[o].size,this.selected_files.splice(o,1);break}n+=l[i].size,this.selected_files.push({file:l[i],upload_callback:t.upload_callback})}e.webkitdirectory&&l.length&&(r=this.create_root_folder_item(n,l),this.selected_files.unshift({file:r,upload_callback:t.upload_callback}),t.upload_type="html5_folder_upload",t.folder_upload_key=t.folder_upload_key||r.name),this.confirm_uploads(t)},_handleFileUploadErrorCallback:function(){this.log_upload_event({event_type:this.ERROR}),this._handleFileUploadErrorHandler()},_handleFileUploadTimeoutCallback:function(){this.log_upload_event({event_type:this.TIMEOUT}),this._handleFileUploadErrorHandler()},_handleFileUploadErrorHandler:function(){var e=this.files[this.uploading];e&&this.retryFileOrCancelAllUploads(e,"")},_handleUploadLoaded:function(e,t){var i,o=this.files[this.uploading],s="";413===e||503===e?(413===e?i="request_entity_too_large":503===e&&(i="rate_limit"),s=this.getUploadErrorMessage(i),this.showUploadErrorNotification(s),this.cancelUploads()):(200>e||e>399)&&(t&&(o.retryCounter=0),this.retryFileOrCancelAllUploads(o,s)),this.request=null,this.handle_upload_finished()},_addXHRUploadEventListeners:function(e){var t=e.upload;t.addEventListener("progress",function(e){this.handle_upload_progress(e.loaded)}.bind(this)),t.addEventListener("error",this._handleFileUploadErrorCallback.bind(this))},_addXHREventListeners:function(e){e.addEventListener("load",function(){this._handleUploadLoaded(e.status)}.bind(this)),e.addEventListener("error",this._handleFileUploadErrorCallback.bind(this)),e.addEventListener("timeout",this._handleFileUploadTimeoutCallback.bind(this))},upload:function(){if(-1!==this.uploading){var e=this.files[this.uploading];e.is_folder?(alert($t('"%1" appears to be a folder, which cannot be uploaded through this interface. To upload folders, click the "Upload" button and select "drag and drop" to upload using the Java uploader.',"error_dnd_folder",this.files[this.uploading].name)),this.skip_file()):e.use_multiput?this.multiput_upload():this.html5_upload()}},html5_upload:function(){this.request=new XMLHttpRequest,this._addXHRUploadEventListeners(this.request),this._addXHREventListeners(this.request),this.files[this.uploading].status="started",this.files[this.uploading].upload_type="html5",this.request.open("POST",this.get_url(),!0),this.request.withCredentials="true",this.request.setRequestHeader("X-File-Name",encodeURIComponent(this.files[this.uploading].name)),this.request.setRequestHeader("X-File-Size",this.files[this.uploading].size),this.request.setRequestHeader("Content-Type","application/octet-stream"),this.request.send(this.files[this.uploading].file)},multiput_upload:function(){var e=this.files[this.uploading];e.status="started",e.upload_type="multiput_api",this.multiput_start_session()},multiput_start_session:function(){if(-1!==this.uploading){var e=this.files[this.uploading];this.multiput_create_sha1_worker(e);var t={folder_id:e.parent_folder.id,file_size:e.size};e.item_to_replace||(t.file_name=e.name);var i=this.append_query_string(e.multiput_start_session_url,t);this.request=this.multiput_create_xhr("POST",i,function(){if(200!==this.request.status)return void this._handleUploadLoaded(this.request.status);var t;try{t=JSON.parse(this.request.responseText)}catch(i){return this._handleUploadLoaded(500)}e.part_size=t.part_size,this.multiput_upload_parts()},this._handleFileUploadErrorCallback),this.request.send(null)}},multiput_create_sha1_worker:function(e){var t=Box.Application.getService("uploads-sha1-worker");e.worker=t.createWorker(),e.worker.addEventListener("message",function(t){var i=t.data;"partDone"==i.type?(e.parts[i.part.number].sha1=i.part.sha1,this.multiput_upload_part(e.parts[i.part.number])):"done"==i.type?(e.sha1=i.sha1,e.worker.terminate(),e.all_parts_done&&this.multiput_commit_session()):"error"==i.type&&this.multiput_failed()}.bind(this)),e.worker.sendPart=function(t){e.worker.postMessage({type:"part",file:e.file,part:t})}},multiput_upload_parts:function(){if(-1!==this.uploading){var e=this.files[this.uploading];e.total_uploaded_bytes=0;for(var t=Math.ceil(e.size/e.part_size),i=[],o=0;t>o;++o){var s=o*e.part_size,a={state:this.PART_STATE_NOT_STARTED,number:o,offset:s,size:Math.min(s+e.part_size,e.size)-s,uploaded_bytes:0,retry_count:0,sha1:null,xhr:null};i.push(a)}e.parts=i;for(var r=0;r<this.MULTIPUT_THREADS;r++)this.multiput_upload_next_part()}},multiput_upload_next_part:function(){if(-1!==this.uploading){for(var e=this.files[this.uploading],t=e.parts,i=!0,o=0,s=0;s<t.length;++s){var a=t[s];if(i=i&&a.state===this.PART_STATE_UPLOADED,a.state===this.PART_STATE_IN_PROGRESS&&++o>=this.MULTIPUT_THREADS)return;if(a.state===this.PART_STATE_NOT_STARTED)return a.state=this.PART_STATE_IN_PROGRESS,void(null!==a.sha1?this.multiput_upload_part(a):e.worker.sendPart(a))}i&&(e.all_parts_done=!0,e.sha1&&this.multiput_commit_session())}},multiput_upload_part:function(e){if(-1!==this.uploading){var t=this.files[this.uploading];e.id=this.multiput_create_part_id(),e.xhr=this.multiput_create_xhr("PUT",t.part_upload_url,function(){if(e.xhr){if(200!==e.xhr.status)return void this.multiput_part_upload_failure(e);e.state=this.PART_STATE_UPLOADED,e.xhr=null,this.multiput_update_progress(e,e.size),this.multiput_upload_next_part()}},this.multiput_part_upload_failure.bind(this,e),function(t){this.multiput_update_progress(e,parseInt(t.loaded,10))}),e.xhr.setRequestHeader("Digest","sha="+btoa(this.decode_hex(e.sha1))),e.xhr.setRequestHeader("X-Box-Part-Id",e.id);var i="bytes "+e.offset+"-"+(e.offset+e.size-1)+"/"+t.size;e.xhr.setRequestHeader("Content-Range",i);var o=t.file.slice(e.offset,e.offset+e.size,"application/octet-stream");e.xhr.timeout=0,this.xhr_send_with_idle_timeout(e.xhr,o,this.MULTIPUT_REQUEST_TIMEOUT,this.multiput_part_upload_failure.bind(this,e))}},multiput_create_part_id:function(){str="";for(var e=0;8>e;e++)str+=String.fromCharCode(Math.floor(255*Math.random()));return btoa(str)},multiput_commit_session:function(){if(-1!==this.uploading){for(var e=this.files[this.uploading],t=e.parts,i=[],o=0;o<t.length;++o){var s=t[o];i.push({part_id:s.id,offset:s.offset,size:s.size})}var a={parts:i},r=this.append_common_url_parameters(e.commit_url);this.request=this.multiput_create_xhr("POST",r,function(){this._handleUploadLoaded(this.request.status,!0)},this.multiput_failed),this.request.setRequestHeader("Digest","sha="+btoa(this.decode_hex(e.sha1))),this.request.send(JSON.stringify(a))}},multiput_abort_session:function(){if(-1!==this.uploading){var e=this.files[this.uploading];if(e.worker&&e.worker.terminate(),e.abort_url){var t=this.multiput_create_xhr("DELETE",e.abort_url);t.send(null)}}},multiput_update_progress:function(e,t){if(-1!==this.uploading){var i=this.files[this.uploading];i.total_uploaded_bytes+=t-e.uploaded_bytes,e.uploaded_bytes=t,this.handle_upload_progress(i.total_uploaded_bytes)}},multiput_part_upload_failure:function(e){return++e.retry_count,e.retry_count>=this.MULTIPUT_NUM_TRIES?void this.multiput_failed():(e.state=this.PART_STATE_NOT_STARTED,e.xhr=null,this.multiput_update_progress(e,0),void this.multiput_upload_next_part())},multiput_failed:function(){this.multiput_abort_session(),this.showUploadErrorNotification(null),this.cancelUploads()},multiput_create_xhr:function(e,t,i,o,s){var a=new XMLHttpRequest;i&&a.addEventListener("load",i.bind(this)),o&&(a.addEventListener("error",o.bind(this)),a.upload.addEventListener("error",o.bind(this)),a.addEventListener("timeout",o.bind(this))),s&&a.upload.addEventListener("progress",s.bind(this)),a.open(e,t,!0);var r=this.files[this.uploading];return r.token&&a.setRequestHeader("Authorization","Bearer "+r.token),a.timeout=this.MULTIPUT_REQUEST_TIMEOUT,a.withCredentials="true",a},xhr_send_with_idle_timeout:function(e,t,i,o){function s(){a&&(clearInterval(a),a=null)}var a,r=0,n=Date.now();e.upload.addEventListener("progress",function(e){e.loaded>r&&(r=e.loaded,n=Date.now())}),e.addEventListener("abort",s),e.addEventListener("load",s),e.addEventListener("error",s),a=setInterval(function(){Date.now()-n<=i||(e.abort(),s(),o&&o())},1e3),e.send(t)},append_query_string:function(e,t){if(!t)return e;var i="";for(var o in t)if(t.hasOwnProperty(o)){var s=encodeURIComponent(o)+"="+encodeURIComponent(t[o]);i+=i?"&"+s:(-1===e.indexOf("?")?"?":"&")+s}return e+i},use_form:function(){return!1},cancel:function(){if(this.multiput_abort_session(),this.request&&(this.request.abort(),this.request=null),-1!==this.uploading){var e=this.files[this.uploading];if(e){if(e.parts)for(var t=e.parts,i=0;i<t.length;++i){var o=t[i];o.state=this.PART_STATE_CANCELLED,o.xhr&&(o.xhr.abort(),o.xhr=null)}this.base(e.upload_session_id)}}},get_file_name:function(e){return e.name},get_file_size:function(e){return e.size},get_last_modified_date:function(e){var t=new Date(e.lastModifiedDate);return t.toUTCString()},get_created_date:function(e){return 0},create_root_folder_item:function(e,t){var i,o="",s=Box.Application.getService("html5-upload");return i=s.getFilePathAsArray(t[0].webkitRelativePath),i&&i.length&&(o=i[0]),s.createFolderItem(o,e,[],Canvas.get().current_folder)},decode_hex:function(e){for(var t="",i=0;i<e.length;i+=2)t+=String.fromCharCode(parseInt(e.substr(i,2),16));return t}},{});Box.Timing.execution.push({name:"js/upload/flash.js",time:(new Date).getTime()});var Upload_Process_Flash=Upload_Process.extend({constructor:function(){this.base(),this.queued_files=[],this.container=null,this.swf_upload=null},get_type:function(){return"flash"},add_trigger:function(e){var t=this,i=$j(e.element);if(i.on("mouseover",function(){var i=$j(this);if(!i.hasClass("disabled")){var o=i.offset(),s=o.left,a=o.top,r=i.outerWidth(),n=i.outerHeight();try{t.swf_upload.setButtonDimensions(r,n),t.swf_upload.setButtonAction(e.single?SWFUpload.BUTTON_ACTION.SELECT_FILE:SWFUpload.BUTTON_ACTION.SELECT_FILES)}catch(l){}t.container.css({left:s+"px",top:a+"px",width:r+"px",height:n+"px"}).show(),t.active_trigger=e,t.last_active_trigger=e,e.over_callback&&e.over_callback()}}),!this.container){this.container=$j("<div/>").mouseout(function(){$j(this).css("left","-1000px"),t.active_trigger&&t.active_trigger.out_callback&&t.active_trigger.out_callback(),t.active_trigger=null}).css({position:"absolute",left:"-1000px","z-index":"3000"}).prependTo("body");var o=$j("<span/>").appendTo(this.container),s=Box.Application.getService("assets"),a=Box.Application.getService("url"),r=s.getFlashAssetURL();this.swf_upload=new SWFUpload({upload_url:a.addAdditionalContext(this.flash_upload_url),flash_url:s.getAssetURL(r,"swfupload.swf"),use_query_string:!0,button_placeholder:o[0],button_cursor:SWFUpload.CURSOR.HAND,button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,file_queue_limit:Upload_Process.MAX_UPLOAD_COUNT_NON_BULK,file_queued_handler:function(e){t.queued_files.push(e)},file_dialog_complete_handler:function(e,i){if(e&&i){t.upload_popup||(t.selected_files=[]);for(var o=t.queued_files,s=0;s<o.length;s++){for(var a=0;a<t.selected_files.length;a++)if(o[s].name==t.selected_files[a].file.name){t.selected_files.splice(a,1);break}t.selected_files.push({file:o[s],swf_upload:t.swf_upload,upload_callback:t.last_active_trigger.upload_callback})}t.queued_files=[],t.confirm_uploads(t.last_active_trigger)}},file_queue_error_handler:function(e,i){i===SWFUpload.QUEUE_ERROR.QUEUE_LIMIT_EXCEEDED?t.handle_upload_error("queue_limit_exceeded"):i===SWFUpload.QUEUE_ERROR.ZERO_BYTE_FILE?t.handle_upload_error("zero_byte_file"):t.handle_upload_error()},upload_progress_handler:function(e,i,o){t.handle_upload_progress(i)},upload_error_handler:function(e,i,o){503==o?t.handle_upload_error("rate_limit"):403==o||500==o?t.handle_upload_error("bad_request"):413==o?t.handle_upload_error("request_entity_too_large"):t.handle_upload_error()},upload_complete_handler:function(e,i,o){t.handle_upload_finished()},file_dialog_start_handler:function(){t.last_active_trigger&&t.last_active_trigger.click_callback&&t.last_active_trigger.click_callback()}})}},upload:function(){if(-1!=this.uploading){var e=Box.Application.getService("url"),t=e.addAdditionalContext(this.flash_upload_url),i=Box.Application.getService("v5"),o=i.get("Realtime_Notification");this.swf_upload.setUploadURL(t),this.files[this.uploading].status="started",this.files[this.uploading].upload_type="flash";var s=this.files[this.uploading].file;this.files[this.uploading].item_to_replace&&this.swf_upload.addFileParam(s.id,"file_id",this.files[this.uploading].item_to_replace.id),this.swf_upload.addFileParam(s.id,"folder_id",this.files[this.uploading].parent_folder.id),this.swf_upload.addFileParam(s.id,"upload_type",this.files[this.uploading].upload_type),this.swf_upload.addFileParam(s.id,"created_date",this.files[this.uploading].created_date),this.swf_upload.addFileParam(s.id,"last_modified_date",this.files[this.uploading].last_modified_date),this.swf_upload.addFileParam(s.id,"upload_session_id",this.files[this.uploading].upload_session_id),this.files[this.uploading].description&&this.swf_upload.addFileParam(s.id,"description",this.files[this.uploading].description),this.files[this.uploading].file_id&&this.swf_upload.addFileParam(s.id,"file_id",this.files[this.uploading].file_id),o.is_enabled()&&this.swf_upload.addFileParam(s.id,"realtime_subscriber_id",o.subscriber_id),this.swf_upload.addFileParam(s.id,"request_token",request_token),this.swf_upload.startUpload(this.files[this.uploading].file.id)}},cancel:function(){if(-1!=this.uploading){var e=this.files[this.uploading];e&&(this.swf_upload.stopUpload(e.file.id),this.base(e.upload_session_id))}},get_file_name:function(e){return e.name},get_file_size:function(e){return e.size},get_last_modified_date:function(e){return e.modificationdate},get_created_date:function(e){return e.creationdate}},{});Box.Timing.execution.push({name:"js/upload/html5_dnd.js",time:(new Date).getTime()});var ZERO_STATE_DRAG_CLASS="zero_state_drag_image",ZERO_STATE_UPLOAD_CLASS="zero_state_upload_image",Upload_Process_HTML5_DND=Upload_Process_HTML5.extend({constructor:function(){this.base(),this.add_dnd_handlers()},init:function(){this.base(),this.highlighted_element=null,this.leave_timeout=null,this.leave_timeout_time=200,this.j_html5_upload_target_overlay=$j("#html5_upload_target_overlay"),this.content_of_dropped_directories={}},_get_class_to_remove_from_item:function(){var e="hover dashed_outline_small";return this.has_items()||(e="receiving_drop dashed_outline_small"),e},_log_drag_and_drop_action:function(){Box.Application.getService("resin").recordAction({application:"files",page:"files",component:"content",feature:"upload",target:"uploaddrop",action:"drop"})},set_normal_state_text_for_dndbox:function(){this.current_folder_has_upload_permission()&&($j("#empty-folder-drag-content").addClass("hidden"),$j("#empty-folder-content").removeClass("hidden"))},set_normal_state_sprites_for_dndbox:function(){this.current_folder_has_upload_permission()&&!this.has_items()&&$j("#empty-folder-upload-image").removeClass(ZERO_STATE_DRAG_CLASS).addClass(ZERO_STATE_UPLOAD_CLASS)},set_drag_state_sprites_for_dndbox:function(){this.current_folder_has_upload_permission()&&!this.has_items()&&$j("#empty-folder-upload-image").removeClass(ZERO_STATE_UPLOAD_CLASS).addClass(ZERO_STATE_DRAG_CLASS)},_reset_files_list_higlight:function(e){e.removeClass("op35"),e.children(".item").removeClass("hover")},_set_files_list_highlight:function(e){e.addClass("op35"),e.children(".item").addClass("hover")},remove_highlighted_class_from_item:function(){this.current_folder_has_upload_permission()&&(this.highlighted_element&&(this.highlighted_element.removeClass(this._get_class_to_remove_from_item()),this.has_items()&&(this.highlighted_element.hasClass("item")&&this.highlighted_element.hasClass("folder")||(this.j_html5_upload_target_overlay.hide(),this._reset_files_list_higlight(this.highlighted_element)))),this.highlighted_element=null)},remove_highlighted_class_from_dndbox:function(){if(this.current_folder_has_upload_permission()){var e=$j("#zero_state_dnd_box");e.length&&e.removeClass("dragging dashed_outline_small")}},set_drag_state_for_dndbox:function(e){this.current_folder_has_upload_permission()&&($j("#zero_state_dnd_box").addClass(e),$j("#empty-folder-content").addClass("hidden"),$j("#empty-folder-drag-content").removeClass("hidden"),this.set_drag_state_sprites_for_dndbox())},zero_state_body_dragleave:function(){this.remove_highlighted_class_from_dndbox(),this.remove_highlighted_class_from_item(),this.set_normal_state_sprites_for_dndbox(),this.has_items()||this.set_normal_state_text_for_dndbox()},zero_state_dndbox_dragover:function(){this.remove_highlighted_class_from_dndbox(),this.remove_highlighted_class_from_item(),this.set_normal_state_sprites_for_dndbox(),this.set_drag_state_for_dndbox("dragging dashed_outline_small")},zero_state_body_dragover:function(e,t){var i=this.has_items(),o={};this.remove_highlighted_class_from_dndbox(),this.remove_highlighted_class_from_item(),this.set_normal_state_sprites_for_dndbox(),o=i?e:t,!i||o.hasClass("item")&&o.hasClass("folder")||(o=o.parents(".item.folder"),!o.length&&this.ajax_dnd_dropzone&&(o=this.ajax_dnd_dropzone)),this.highlighted_element=o,i?o.hasClass("item")&&o.hasClass("folder")||!this.j_html5_upload_target_overlay.length||!$j(".foot").length?o.addClass("hover dashed_outline_small"):(this.j_html5_upload_target_overlay.show().css({width:o.css("width"),height:$j(".foot").offset().top-o.offset().top-5}),this._set_files_list_highlight(o)):this.set_drag_state_for_dndbox("receiving_drop dashed_outline_small")},set_zero_state_body_dragenter:function(e){return e.stopPropagation(),e.preventDefault(),!1},set_zero_state_body_dragleave:function(e){e.stopPropagation(),e.preventDefault();var t=Upload_Process.get();return t.current_folder_has_upload_permission()?(clearTimeout(t.leave_timeout),t.leave_timeout=setTimeout(function(){t.zero_state_body_dragleave()},t.leave_timeout_time),!1):!1},set_zero_state_body_dragover:function(e){e.stopPropagation(),e.preventDefault();var t=e&&e.dataTransfer||e&&e.originalEvent&&e.originalEvent.dataTransfer;try{if(t&&"none"===t.dropEffect)switch(t.effectAllowed){case"copy":case"copyMove":t.dropEffect="copy";break;case"move":t.dropEffect="move"}}catch(i){}var o=Upload_Process.get();if(!o.current_folder_has_upload_permission())return!1;if(clearTimeout(o.leave_timeout),!$j.popup.get().length){var s=$j(e.target),a=$j("#zero_state_dnd_box");s.closest("#zero_state_dnd_box").length?o.zero_state_dndbox_dragover():o.zero_state_body_dragover(s,a)}return!1},set_zero_state_drop:function(e){e.stopPropagation(),e.preventDefault();var t=Upload_Process.get();return t.current_folder_has_upload_permission()?($j.popup.get().length||(t.handle_drop(e),t.has_items()&&(t.remove_highlighted_class_from_item(),t.remove_highlighted_class_from_dndbox(),t.set_normal_state_text_for_dndbox())),!1):!1},add_zero_state_dnd_handlers_to_body:function(){var e=$j("body");e.unbind("dragover").bind("dragover",this.set_zero_state_body_dragover),e.unbind("dragleave").bind("dragleave",this.set_zero_state_body_dragleave),e.unbind("dragenter").bind("dragenter",this.set_zero_state_body_dragenter),e.unbind("drop").bind("drop",this.set_zero_state_drop)},add_dnd_handlers:function(){this.add_zero_state_dnd_handlers_to_body()},handle_drop:function(e){var t,i,o,s,a=this.get_target_folder_from_drop_event(e),r=e.originalEvent.dataTransfer;if(!a.permissions.upload)return this.show_no_upload_permission_popup(),!1;t=r.files,i=r.items;var n=this.browser.canFolderUpload(),l=null;if(!n&&r.types&&r.types.length&&t&&!t.length)l=r.types;else if(!n&&t&&t.length)for(o=0;o<t.length;o++)if("type"in t[o]&&!t[o].type&&!t[o].size){l=[t[o].name];break}if(l)return void this.report_ambiguous_folder_or_zero_byte_files(Array.prototype.slice.call(l,0));if(t&&this.validate_num_items(t)&&(!this.browser.canFolderUpload()||!i||this.validate_num_items(i)))if(this._log_drag_and_drop_action(),this.browser.canFolderUpload()&&i&&i.length)for(this.content_of_dropped_directories={},o=0,s=i.length;s>o;o++){var _=i[o].webkitGetAsEntry();if(_&&_.isFile){var d=null;o<t.length&&(d=t[o]),this.add_file_entry_to_queue(_,a,d)}else _&&_.isDirectory&&(this.content_of_dropped_directories[_.name]={entries_left:1,items:[],size:0},this.add_folder_entry_to_queue(_,[],_.name,a))}else this.add_items_to_upload_queue(t,i,a)},add_items_to_upload_queue:function(e,t,i,o){for(var s=[],a=[],r=[],n=[],l=[],_=0,d={},u=!1,p=Box.Application.getService("upload-process"),h=0;h<e.length;h++){if(!this.browser.canFolderUpload()){if(p.isItemUnsupportediWorkFile(e[h])){s.push(e[h].name);continue}if(p.isItemUnsupportedPackageFile(e[h])){a.push(e[h].name);continue}if(this._item_is_a_folder_or_zero_byte_file(e[h])){n.push(e[h].name);continue}if(this._item_is_a_folder(t,h)){l.push(e[h].name);continue}}var c=i.id,f=new Upload_Process.Item({name:e[h].name,size:e[h].size,progress:0,mime_type:e[h].type,file:e[h],blob:"",dropped:!0,parent_folder:{id:c,name:i.name},relative_folder_path:e[h].relative_folder_path,path_identifier:p.getIdentifierPath(c.toString(),e[h].relative_folder_path),is_folder:e[h].is_folder,folder_upload_key:o,last_modified_date:new Date(e[h].lastModifiedDate).toUTCString()});u=u||e[h].is_folder;var m=this.is_item_too_large(i,f);m?r.push(m):(this.add_to_queue(f),_++)}this.report_iwork_files(s),this.report_unsupported_package_files(a),r&&this.report_large_file_errors(r,i),this.report_ambiguous_folder_or_zero_byte_files(n),this.report_folder_files(l),this.update_progress(),d={total_files:e.length,large_files:r.length,ambigious_files:n.length,folder_files:l.length,
num_uploaded_files:_,folder_upload:u},this.upload_log_event("dnd_drop_event",d)},report_large_file_errors:function(e,t){var i=Box.Application.getService("upload-process");i.showItemTooLargePopup(e[0],t)},validate_num_items:function(e){return 0===e.length?(this.report_upload_error(),!1):this.are_too_many_files_selected(e)?(this.show_too_many_files_popup(),!1):!0},_item_is_a_folder_or_zero_byte_file:function(e){var t=this.browser,i=t.isFirefox()||t.isSafari()||t.isChrome()&&!t.isMinBrowser("Chrome",18);return i&&0==e.size&&!e.type||t.isSafari()&&68==e.size&&!e.type?!0:!1},_item_is_a_folder:function(e,t){if(e&&this.browser.isChrome()){var i=e[t];if(i&&$j.isFunction(i.webkitGetAsEntry)&&i.webkitGetAsEntry().isDirectory)return!0}return!1},reset:function(){this.base(),this.highlighted_element=null},use_form:function(){return!1},get_target_folder_from_drop_event:function(e){var t=Canvas.get().current_folder,i=t.id,o=$j(e.target);if(o.is(".item.folder")||(o=o.parents(".item.folder")),o.length>0){var s=o.attr("id"),a=s.substring(5,s.length);if(a){i=a;var r=Item.find(a);if(r)return r}}return t},report_upload_error:function(){var e=Box.Application;e.getService("logger").sendLog("upload_process_log_event","NO_ITEM_SELECTED_FOR_DRAG_AND_DROP"),e.getService("popups").alert($t("Please select a file/folder from your computer in order to drag and drop.","error_generic_upload_html5_dnd_files_folder"))},add_file_entry_to_queue:function(e,t,i){var o=this;e&&e.isFile&&e.file(function(e){o.add_items_to_upload_queue([e],null,t)},function(s){if(s&&"EncodingError"===s.name&&null!==i)o.add_items_to_upload_queue([i],null,t);else{var a=$t("We are unable to upload the file %1. Please make sure it is not a link.","error_unable_to_upload_link",e.name),r={name:e.name,fullPath:e.fullPath};Box.Application.getService("popups").alert(a),o.upload_log_event("dnd_convert_file_entry_error",r)}})},handle_directory_read_success:function(e,t,i,o,s){var a=Box.Application.getService("html5-upload");this.content_of_dropped_directories[o].entries_left+=t.length;var r=a.createFolderItem(e.name,0,i,s);this.add_item_to_content_of_dropped_directories(r,o),i.push(e.name),this.process_child_entries(t,i,o,s),this.check_is_directory_conversion_complete(o,s)},add_folder_entry_to_queue:function(e,t,i,o){var s=this,a=t.slice();if(e&&e.isFile)e.file(function(e){e.relative_folder_path=a,s.add_item_to_content_of_dropped_directories(e,i),s.check_is_directory_conversion_complete(i,o)},function(){s.handle_error_in_entry_read(i),s.check_is_directory_conversion_complete(i,o)});else if(e&&e.isDirectory){var r=e.createReader(),n=[],l=function(){r.readEntries(function(t){if(t.length){var r=Array.prototype.slice.call(t||[],0);n=n.concat(r),l()}else s.handle_directory_read_success(e,n,a,i,o)},function(){this.handle_error_in_entry_read(i),this.check_is_directory_conversion_complete(i,o)})};l()}else this.handle_error_in_item_read(i)},process_child_entries:function(e,t,i,o){var s,a;for(s=0,a=e.length;a>s;s++)this.add_folder_entry_to_queue(e[s],t,i,o)},handle_error_in_entry_read:function(e){this.content_of_dropped_directories[e].entries_left-=1},check_is_directory_conversion_complete:function(e,t){this.content_of_dropped_directories[e].entries_left||this.add_directory_items_to_upload_queue(e,t)},add_item_to_content_of_dropped_directories:function(e,t){var i=this.content_of_dropped_directories[t];i.size+=e.size,i.items.push(e),i.entries_left-=1},add_directory_items_to_upload_queue:function(e,t){var i,o=this.content_of_dropped_directories[e];if(!o.entries_left){i=o.items[0],i.size=o.size;var s=this.is_item_too_large_for_destination_folder(t,i);s?Box.Application.getService("upload-process").showItemTooLargePopup(s,t):this.add_items_to_upload_queue(o.items,null,t,e),delete this.content_of_dropped_directories[e]}}},{});Box.Timing.execution.push({name:"js/services/filepicker.js",time:(new Date).getTime()}),Box.Application.addService("filepicker",function(e){"use strict";function t(e,t){this.$bindElement=$(e),this.dataParams=t,this.$inputWrapper=null,this.inputWrapperTag=t.wrapperTag||"div",this.previousTabIndex=null}return t.prototype={destroy:function(){this.$bindElement.off(".filepicker"),this.previousTabIndex&&this.$bindElement.attr({tabindex:this.previousTabIndex}),this.previousTabIndex=null,this.$inputElement.off(".filepicker"),this.$inputElement.remove(),this.$inputWrapper.remove(),this.$inputElement=null,this.dataParams=null,this.uploadProcessService=null},init:function(){var t=this,i=e.getService("templates"),o=this.dataParams.isAjaxUpload,s=e.getService("upload-process"),a=this.dataParams;if(!this.$bindElement.hasClass("disabled")){var r={name:a.name||"upload_element"};o&&s.disableUploadElementForAjaxEol(this.$bindElement[0]),a.single||(r.multiple="true"),a.directory_upload&&(r.webkitdirectory="true"),a.acceptType&&(r.accept=this.dataParams.acceptType),this.$inputElement=$(i.getTemplateHTML("filepicker-widget")).attr(r),this.$inputElement.on("mouseover.filepicker",function(){return a.over_callback?void a.over_callback():void t.$bindElement.addClass("hover")}).on("focusin.filepicker",function(){return a.focusin_callback?void a.focusin_callback():void t.$bindElement.addClass("hover focus_outline")}).on("mouseout.filepicker",function(){return t.hideInputElement(),a.out_callback?void a.out_callback():void t.$bindElement.removeClass("hover")}).on("focusout.filepicker",function(){return a.focusout_callback?void a.focusout_callback():void t.$bindElement.removeClass("hover focus_outline")}).on("click.filepicker",function(){var i=null,r=null,n=null;return o?(s.showAjaxEolMessage(),!1):t.$bindElement.hasClass("files_buttons_disabled")?!1:(a&&a.shouldLogToResin&&(i=e.getService("resin"),n=a.resinParams,r=n.target||"upload",i.recordAction({application:"files",page:"files",component:"actionbar|uploadmenu",feature:n.feature,target:r,action:"click"})),a.click_callback&&a.click_callback(),!0)}).on("change.filepicker",function(){return o?(s.showAjaxEolMessage(),!1):(t.hideInputElement(),a.out_callback&&a.out_callback(),void(a.handle_change&&a.handle_change(this,a)))}),this.$inputWrapper=$(document.createElement(this.inputWrapperTag)),this.$inputWrapper.addClass("fp-wrapper"),this.$inputElement.appendTo(this.$inputWrapper),this.$bindElement.css({position:"static"!==this.$bindElement.css("position")?this.$bindElement.css("position"):"relative"}),this.previousTabIndex=this.$bindElement.attr("tabindex"),this.$bindElement.attr({tabindex:"-1"}),this.$bindElement.on("mouseover.filepicker",function(){t.showInputElement()}),this.hideInputElement(),this.$inputWrapper.insertAfter(this.$bindElement)}},showInputElement:function(){var e=this.$bindElement[0],t=e.offsetLeft,i=e.offsetTop,o=e.offsetWidth,s=e.offsetHeight;this.$inputWrapper.css({left:t+"px",top:i+"px",display:"block",width:o+"px",height:s+"px",opacity:"0",overflow:"hidden",cursor:"pointer"});var a=o>this.$inputElement[0].offsetWidth?o:this.$inputElement[0].offsetWidth,r=s>this.$inputElement[0].offsetHeight?s:this.$inputElement[0].offsetHeight;this.$inputElement.css({width:a+"px",height:r+"px"})},hideInputElement:function(){this.$inputWrapper.css({height:"1px",width:"1px",left:"0",top:"0",overflow:"hidden",opacity:"0",position:"absolute"}),this.$inputWrapper.attr({tabindex:"-1"})},open:function(){this.$inputElement[0].click()}},{create:function(e,i){return new t(e,i)}}}),Box.Timing.execution.push({name:"js/services/html5-upload.js",time:(new Date).getTime()}),Box.Application.addService("html5-upload",function(e){"use strict";function t(e){return e.name}function i(e){return e.lastModifiedDate}function o(e){return!(e&&"function"==typeof e.pop)}var s,a="/",r="\\";return{FOLDER_UPLOAD_CLASS:"chromeFolderUploader",getFilePathAsArray:function(e){var t=[];return t=e.split(e.indexOf(a)>-1?a:r),$.grep(t,function(e){return""!==e})},getWebkitFileData:function(e){var s,a,r,n=!1;return s=e.webkitRelativePath,s&&(s=this.getFilePathAsArray(s),!o(s))?(s.pop(),a=t(e),"."===a&&(a=s[s.length-1],n=!0),r=i(e),{name:a,relativeFolderPath:s,isFolder:n,lastModifiedDate:r}):void 0},createFolderItem:function(t,i,o,a){var r,n=o.slice();return s=e.getService("v5"),r=s.get("Upload_Process"),n.push(t),r.get_static_item({name:t,size:i,type:"",relative_folder_path:n,dropped:!0,parent_folder:{id:a.id,name:a.name},is_folder:!0})}}}),Box.Timing.execution.push({name:"js/services/upload-process.js",time:(new Date).getTime()}),Box.Application.addService("upload-process",function(e){"use strict";function t(){return $t("We're sorry, but we can't complete that upload for you. Please upgrade to the latest version of your browser or install the latest version of Flash.","up_ajax_end_message")}function i(t,i){var o,s=e.getService("notifications");1===t&&i>1?o=$t("1 folder and %1 files have been uploaded to your account.","one_folder_many_files_upload_message",i):1===t&&1===i?o=$t("1 folder and 1 file have been uploaded to your account.","one_folder_one_file_upload_message"):1===t?o=$t("1 folder has been uploaded to your account.","one_folder_upload_message"):t>1&&i>1?o=$t("%1 folders and %2 files have been uploaded to your account.","many_folder_many_files_upload_message",t,i):t>1&&1===i?o=$t("%1 folders and 1 file have been uploaded to your account.","many_folders_one_file_upload_message",t):t>1&&(o=$t("%1 folders have been uploaded to your account.","many_folders_upload_message",t)),s.confirm(o,{legacy:{disable_scroll:!0}})}function o(){var e={},t=v.get("Canvas").collections,i=v.get("window"),o=g.get();return e.url=i.location.pathname,e.is_shared_page=g.isSharedPage()||g.isSharedFilePage(),e.page_type=o.type,e.is_preview=o.isGallery,e.is_root_folder=g.isRootFolder(),e.is_empty_state=!1,t&&t.length>0&&t[0].items&&(e.is_empty_state=0===t[0].items.length),e}function s(){return{can_use_dnd:b.canUseHtml5Dnd()}}function a(e){{var t=e.item,i=v.get("Canvas"),o=i.target_item,s=i.current_folder;g.get()}return!(!g.isPreviewOpen()&&s&&s.typed_id||!o||t&&t.id!==o.id)}function r(e,t){for(var i,o=e.length,s=0;s<t.length;s++)if(i=t[s],-1!==e.indexOf(i,o-i.length))return!0;return!1}function n(e){return r(e,c)}function l(t,i){e.getService("popups").confirm(t,{title:$t("Upload Error","upload_error"),cancelText:$t("Close","close"),confirmText:$t("More Info","more_info"),onconfirm:function(){return y.openWindow(i),!1}})}var _=100,d=2147483648,u=4294967296,p="https://support.box.com/hc/en-us/articles/201380753",h="https://support.box.com/hc/en-us/articles/200520238-What-s-the-maximum-file-size-I-can-upload",c=[".key",".numbers",".pages"],f=[".graffle",".agilekeychain",".rtfd"],m=300,g=e.getService("nav-state"),v=e.getService("v5"),b=e.getService("browser"),y=e.getService("url");return{handleAllItemsUploadFinished:function(e){var t,o={},s=v.get("Box_Confirmation_Message_Builder"),a="/index.php?rm=box_get_items",r=!1,n=0;o.upload_session_ids=[];for(t in e)e[t].is_folder?(r=!0,n++):o.upload_session_ids.push(e[t].upload_session_id);0===o.upload_session_ids.length?i(n,0):$.getJSON(a,$.box.formatQuery(o),function(e){var t,o,a={},l=0;if(!e.error){for(o in e.items)t=e.items[o],a[t.typed_id]={id:t.id,name:t.name,type:t.type};l=e.items?e.items.length:0,r?i(n,l):s.show_notification_for_new_items(a)}})},handleItemUploadFinished:function(t,i){var o=v.get("Upload_Process"),s=v.get("Canvas"),r=t.item&&!t.is_folder,n=s.target_item;return a(t)?(r&&g.isPreviewOpen()&&e.broadcast("previewaction",{action:"invalidatecache",itemTypedID:t.item.typed_id,fileId:t.item.id}),void n.refresh(function(){e.navigate("",{},{callback:function(){r?o.refresh_file_after_upload(t,i):t.is_folder||o._handle_reload_updated_file_callback(t)},not_scroll:!0})})):void(r&&o.refresh_file_after_upload(t,i))},updateFolderProgress:function(e,t){var i,o,s={},a=v.get("Upload_Process");if(0!==t){for(;e in a.folder_id_to_item_index&&!(e in s);)s[e]=1,i=a.folder_id_to_item_index[e].index,o=a.files[i],o.progress+=t,e=a.folder_id_to_item_index[e].parent_folder_id;o&&o.size<=o.progress&&o.item&&(o.status="completed",a.refresh_folder_after_upload(o))}},logUploadEvent:function(t,i){var a=e.getService("logger");i=$.extend({},i,s(),o()),a.sendLog("upload_process_log_event",t,i)},ERROR_TYPES:{FOLDER_NOT_FOUND:"folder_not_found",LARGER_THAN_FOLDER:"larger_than_folder_space",LARGER_THAN_MAX_SIZE:"larger_than_max_upload_size",LARGER_THAN_FOLDER_MAX_SIZE:"larger_than_folder_max_upload_size"},showItemTooLargePopup:function(e,t){var i=v.get("Upload_Process");switch(e){case this.ERROR_TYPES.FOLDER_NOT_FOUND:i.show_folder_not_found_popup();break;case this.ERROR_TYPES.LARGER_THAN_FOLDER:i.show_folder_free_space_limitation_popup(t);break;case this.ERROR_TYPES.LARGER_THAN_MAX_SIZE:i.show_maximum_upload_popup(i.get_max_file_size());break;case this.ERROR_TYPES.LARGER_THAN_FOLDER_MAX_SIZE:i.show_folder_upload_size_limitation_popup(t)}},showTooManyFilesPopup:function(){var t=e.getService("v5popups");return b.canFolderUpload()?void t.showTooManyFilesUseFolderPopup(_):void t.showTooManyFilesUseJavaPopup(_)},isItemUnsupportediWorkFile:function(e){return e.size<m&&n(e.name)},showUnsupportediWorkFilePopup:function(e){var t=$t("iWork 2013 files are package files which cannot be uploaded through the web application. The following files were not uploaded: %1","iwork_popup_error",e.join(", "));l(t,p)},isItemUnsupportedPackageFile:function(e){return r(e.name,f)},showUnsupportedPackageFilePopup:function(e){var t=$t("A few files were package files which cannot be uploaded through the web application. The following files were not uploaded: %1","package_popup_error",e.join(", "));l(t,p)},showAjaxEolMessage:function(){var i=e.getService("popups"),o=t(),s=$t("Upload Warning","upload_warning");i.alert(o,{title:s})},getItemPath:function(e){var t=e.relative_folder_path;if(e.is_folder)return t.join("\\");var i=e.name,o="";return t&&t.length>0&&(o=t.join("\\")+"\\"),o+i},getIdentifierPath:function(e,t){return t&&t.length?e+t.join(""):""},disableUploadElementForAjaxEol:function(i,o){var s="default"===v.get("Upload_Process").get_type();if(s){var a=e.getService("dom");o?a.addClass(i,"op35"):a.addClass(i,"disabled"),i.setAttribute("data-hover","tooltip"),i.setAttribute("aria-label",t())}},isItemTooLargeForIE:function(e){if(!b.isIE())return!1;var t=parseFloat(b.getVersion());return 8>=t&&e.size>=d?!0:t>8&&10>=t&&e.size>=u?!0:!1},showIELargeItemError:function(){e.getService("popups").confirm($t("Please note that Internet Explorer applies file-size upload and download limits that supersede Box account-level upload limits. Users accessing Box through Internet Explorer versions 6-8 can only upload files under 2GB in size. Users accessing Box through Internet Explorer versions 9 and 10 can only upload files under 4GB in size.","upload_ie_large_error"),{title:$t("Upload Error","upload_error"),cancelText:$t("Close","close"),confirmText:$t("More Info","more_info"),onconfirm:function(){return y.openWindow(h),!1}})}}}),Box.Timing.execution.push({name:"js/services/fake-item.js",time:(new Date).getTime()}),Box.Application.addService("fake-item",function(e){"use strict";function t(){this.itemEl=null}function i(){var t=e.getService("datetime"),i=t.FORMAT_TYPES.MONTH_DAY;return $t("Updated %1 by You","updated_now_by_you_message",t.formatRelativeDateInUserTimezone(t.getCurrentTimestampInSeconds(),i))}function o(){var t=e.getService("datetime"),i=t.FORMAT_TYPES.MONTH_DAY;return $t("Uploaded %1 by You","uploaded_now_by_you_message",t.formatRelativeDateInUserTimezone(t.getCurrentTimestampInSeconds(),i))}function s(t){var i="",o=t.progress,s=t.size,a=t.is_folder,r=e.getService("v5").get("Item"),n=e.getService("strings");if(!o&&a)i=$t("Creating folder","inline_upload_progress_create_folder");else if(o||a)if(o===s){var l=r.find(t.parent_folder.id);l&&l.is_encrypted_at_rest()?(i=$t("Encrypting file...","inline_upload_encrypting_upload"),a&&(i=$t("Encrypting folder contents...","inline_upload_encrypting_upload_folder"))):i=$t("Processing upload...","inline_upload_processing_upload")}else i=$t("Uploading %1 of %2","inline_upload_progress_uploading",n.getHumanReadableSize(o,2),n.getHumanReadableSize(s,2));else i=$t("Waiting to upload","inline_upload_progress_waiting");return i}function a(t,i){var o=e.getService("dom"),s=o.query(".inline-progress-message",i);o.setHTML(s,t)}function r(t,i,o){for(var s=e.getService("dom"),a=s.queryAll(".progress_bar",o),r=null,n=0,l=0;l<a.length;l++)r=a[l],i>0&&(n=t/i*100,0>n?n=0:n>100&&(n=100)),r.style.width=n+"%"}function n(t,a){var r=e.getService("strings"),n=e.getService("thumbnail"),l=t.item_to_replace&&t.item_to_replace.id?i():o(),_={};return t.is_folder?(_.blank32=_.sprite32="sprite_32x32_folder",_.blank80=_.sprite80="sprite_48x48_folder"):(_.blank32="sprite_doc_32_32-blank",_.blank80="sprite_doc_80_80-blank",_.sprite32=n.getFileTypeIcon(t.name,"32"),_.sprite80=n.getFileTypeIcon(t.name,"80")),_.fileName=t.name,_.fileSize=0,1!=t.size&&(_.fileSize=r.getHumanReadableSize(t.size,2)),_.fileDescription=l,_.inlineProgressMessage=s(t),_}return t.prototype={init:function(t){var i=e.getService("templates"),o=null,s=n(t,this.itemEl);return o=$(i.getTemplateHTML("fake-item",s)),o.attr({id:"upl_"+t.id}),this.itemEl=o[0],this.setClickHandler(t,this.itemEl),this.setCancelClickHandler(t,this.itemEl),this.addToCanvasCollection(t)},destroy:function(){$(this.itemEl).remove(),this.itemEl=null},getElement:function(){return this.itemEl},setClickHandler:function(t,i){$(i).on("click",function(i){var o=e.getService("nav-url");t.is_folder&&"success"===t.status&&t.item&&e.navigate(o.getFolderUrl(t.item.id,0))})},setCancelClickHandler:function(t,i){var o=e.getService("dom"),s=o.queryAll(".item-cancel",i);$(s).on("click",function(i){var o=e.getService("v5").get("Upload_Process");t.is_folder?o.skip_folder(t):o.skip_file(t),i.stopPropagation()})},unbindCancelClick:function(){var t=e.getService("dom"),i=t.queryAll(".item-cancel",this.itemEl);t.addClass(i,"hidden"),$(i).unbind("click")},updateItem:function(e){a(s(e),this.itemEl),r(e.progress,e.size,this.itemEl),e.progress===e.size&&this.unbindCancelClick()},addToCanvasCollection:function(t){var i=e.getService("v5").get("Canvas"),o=e.getService("v5").get("Upload_Process"),s=i.collections[0],a=null,r=null,n=null,l="upl_"+t.id,_=e.getService("v5").get("Item"),d=o.check_for_upload_new_version(t);return a=t.item_to_replace,"invalid"===d?(o.skip_file(t),!1):(a?(r=$("#c0_"+a.typed_id),n=r.next(".item_expansion"),r.add(n).remove(),t.$item_to_replace=r,a.upload_id=l,t.item=a):(t.item=new _({parent:t.parent_folder.id,name:t.name,upload_id:l,collection:s,index:s.items.length,element:this.itemEl,type:t.is_folder?"folder":"file",just_uploaded:!0,permissions:{}}),s.prepend(t.item)),!0)}},{create:function(){return new t}}}),Box.Timing.execution.push({name:"js/plugins/swfupload-2.2.0.1.js",time:(new Date).getTime()});var SWFUpload;void 0==SWFUpload&&(SWFUpload=function(e){this.initSWFUpload(e)}),SWFUpload.prototype.initSWFUpload=function(e){try{this.customSettings={},this.settings=e,this.eventQueue=[],this.movieName="SWFUpload_"+SWFUpload.movieCount++,this.movieElement=null,SWFUpload.instances[this.movieName]=this,this.initSettings(),this.loadFlash(),this.displayDebugInfo()}catch(t){throw delete SWFUpload.instances[this.movieName],t}},SWFUpload.instances={},SWFUpload.movieCount=0,SWFUpload.version="2.2.0 2009-03-25",SWFUpload.QUEUE_ERROR={QUEUE_LIMIT_EXCEEDED:-100,FILE_EXCEEDS_SIZE_LIMIT:-110,ZERO_BYTE_FILE:-120,INVALID_FILETYPE:-130},SWFUpload.UPLOAD_ERROR={HTTP_ERROR:-200,MISSING_UPLOAD_URL:-210,IO_ERROR:-220,SECURITY_ERROR:-230,UPLOAD_LIMIT_EXCEEDED:-240,UPLOAD_FAILED:-250,SPECIFIED_FILE_ID_NOT_FOUND:-260,FILE_VALIDATION_FAILED:-270,FILE_CANCELLED:-280,UPLOAD_STOPPED:-290},SWFUpload.FILE_STATUS={QUEUED:-1,IN_PROGRESS:-2,ERROR:-3,COMPLETE:-4,CANCELLED:-5},SWFUpload.BUTTON_ACTION={SELECT_FILE:-100,SELECT_FILES:-110,START_UPLOAD:-120},SWFUpload.CURSOR={ARROW:-1,HAND:-2},SWFUpload.WINDOW_MODE={WINDOW:"window",TRANSPARENT:"transparent",OPAQUE:"opaque"},SWFUpload.completeURL=function(e){if("string"!=typeof e||e.match(/^https?:\/\//i)||e.match(/^\//)||""==e)return e;var t,i=(window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""),window.location.pathname.lastIndexOf("/"));return t=0>=i?"/":window.location.pathname.substr(0,i)+"/",t+e},SWFUpload.prototype.initSettings=function(){this.ensureDefault=function(e,t){this.settings[e]=void 0==this.settings[e]?t:this.settings[e]},this.ensureDefault("upload_url",""),this.ensureDefault("preserve_relative_urls",!1),this.ensureDefault("file_post_name","Filedata"),this.ensureDefault("post_params",{}),this.ensureDefault("use_query_string",!1),this.ensureDefault("requeue_on_error",!1),this.ensureDefault("http_success",[]),this.ensureDefault("assume_success_timeout",0),this.ensureDefault("file_types","*.*"),this.ensureDefault("file_types_description","All Files"),this.ensureDefault("file_size_limit",0),this.ensureDefault("file_upload_limit",0),this.ensureDefault("file_queue_limit",0),this.ensureDefault("flash_url","swfupload.swf"),this.ensureDefault("prevent_swf_caching",!0),this.ensureDefault("button_image_url",""),this.ensureDefault("button_width",1),this.ensureDefault("button_height",1),this.ensureDefault("button_text",""),this.ensureDefault("button_text_style","color: #000000; font-size: 16pt;"),this.ensureDefault("button_text_top_padding",0),this.ensureDefault("button_text_left_padding",0),this.ensureDefault("button_action",SWFUpload.BUTTON_ACTION.SELECT_FILES),this.ensureDefault("button_disabled",!1),this.ensureDefault("button_placeholder_id",""),this.ensureDefault("button_placeholder",null),this.ensureDefault("button_cursor",SWFUpload.CURSOR.ARROW),this.ensureDefault("button_window_mode",SWFUpload.WINDOW_MODE.WINDOW),this.ensureDefault("debug",!1),this.settings.debug_enabled=this.settings.debug,this.settings.return_upload_start_handler=this.returnUploadStart,this.ensureDefault("swfupload_loaded_handler",null),this.ensureDefault("file_dialog_start_handler",null),this.ensureDefault("file_queued_handler",null),this.ensureDefault("file_queue_error_handler",null),this.ensureDefault("file_dialog_complete_handler",null),this.ensureDefault("upload_start_handler",null),this.ensureDefault("upload_progress_handler",null),this.ensureDefault("upload_error_handler",null),this.ensureDefault("upload_success_handler",null),this.ensureDefault("upload_complete_handler",null),this.ensureDefault("debug_handler",this.debugMessage),this.ensureDefault("custom_settings",{}),this.customSettings=this.settings.custom_settings,this.settings.prevent_swf_caching&&(this.settings.flash_url=this.settings.flash_url+(this.settings.flash_url.indexOf("?")<0?"?":"&")+"preventswfcaching="+(new Date).getTime()),this.settings.preserve_relative_urls||(this.settings.upload_url=SWFUpload.completeURL(this.settings.upload_url),this.settings.button_image_url=SWFUpload.completeURL(this.settings.button_image_url)),delete this.ensureDefault},SWFUpload.prototype.loadFlash=function(){var e,t;if(null!==document.getElementById(this.movieName))throw"ID "+this.movieName+" is already in use. The Flash Object could not be added";if(e=document.getElementById(this.settings.button_placeholder_id)||this.settings.button_placeholder,void 0==e)throw"Could not find the placeholder element: "+this.settings.button_placeholder_id;t=document.createElement("div"),t.innerHTML=this.getFlashHTML(),e.parentNode.replaceChild(t.firstChild,e),void 0==window[this.movieName]&&(window[this.movieName]=this.getMovieElement())},SWFUpload.prototype.getFlashHTML=function(){return['<object id="',this.movieName,'" type="application/x-shockwave-flash" data="',this.settings.flash_url,'" width="',this.settings.button_width,'" height="',this.settings.button_height,'" class="swfupload">','<param name="wmode" value="',this.settings.button_window_mode,'" />','<param name="movie" value="',this.settings.flash_url,'" />','<param name="quality" value="high" />','<param name="menu" value="false" />','<param name="allowScriptAccess" value="always" />','<param name="flashvars" value="'+this.getFlashVars()+'" />',"</object>"].join("")},SWFUpload.prototype.getFlashVars=function(){var e=this.buildParamString(),t=this.settings.http_success.join(",");return["movieName=",encodeURIComponent(this.movieName),"&amp;uploadURL=",encodeURIComponent(this.settings.upload_url),"&amp;useQueryString=",encodeURIComponent(this.settings.use_query_string),"&amp;requeueOnError=",encodeURIComponent(this.settings.requeue_on_error),"&amp;httpSuccess=",encodeURIComponent(t),"&amp;assumeSuccessTimeout=",encodeURIComponent(this.settings.assume_success_timeout),"&amp;params=",encodeURIComponent(e),"&amp;filePostName=",encodeURIComponent(this.settings.file_post_name),"&amp;fileTypes=",encodeURIComponent(this.settings.file_types),"&amp;fileTypesDescription=",encodeURIComponent(this.settings.file_types_description),"&amp;fileSizeLimit=",encodeURIComponent(this.settings.file_size_limit),"&amp;fileUploadLimit=",encodeURIComponent(this.settings.file_upload_limit),"&amp;fileQueueLimit=",encodeURIComponent(this.settings.file_queue_limit),"&amp;debugEnabled=",encodeURIComponent(this.settings.debug_enabled),"&amp;buttonImageURL=",encodeURIComponent(this.settings.button_image_url),"&amp;buttonWidth=",encodeURIComponent(this.settings.button_width),"&amp;buttonHeight=",encodeURIComponent(this.settings.button_height),"&amp;buttonText=",encodeURIComponent(this.settings.button_text),"&amp;buttonTextTopPadding=",encodeURIComponent(this.settings.button_text_top_padding),"&amp;buttonTextLeftPadding=",encodeURIComponent(this.settings.button_text_left_padding),"&amp;buttonTextStyle=",encodeURIComponent(this.settings.button_text_style),"&amp;buttonAction=",encodeURIComponent(this.settings.button_action),"&amp;buttonDisabled=",encodeURIComponent(this.settings.button_disabled),"&amp;buttonCursor=",encodeURIComponent(this.settings.button_cursor)].join("")},SWFUpload.prototype.getMovieElement=function(){if(void 0==this.movieElement&&(this.movieElement=document.getElementById(this.movieName)),null===this.movieElement)throw"Could not find Flash element";return this.movieElement},SWFUpload.prototype.buildParamString=function(){var e=this.settings.post_params,t=[];if("object"==typeof e)for(var i in e)e.hasOwnProperty(i)&&t.push(encodeURIComponent(i.toString())+"="+encodeURIComponent(e[i].toString()));return t.join("&amp;")},SWFUpload.prototype.destroy=function(){try{this.cancelUpload(null,!1);var e=null;if(e=this.getMovieElement(),e&&"unknown"==typeof e.CallFunction){for(var t in e)try{"function"==typeof e[t]&&(e[t]=null)}catch(i){}try{e.parentNode.removeChild(e)}catch(o){}}return window[this.movieName]=null,SWFUpload.instances[this.movieName]=null,delete SWFUpload.instances[this.movieName],this.movieElement=null,this.settings=null,this.customSettings=null,this.eventQueue=null,this.movieName=null,!0}catch(s){return!1}},SWFUpload.prototype.displayDebugInfo=function(){this.debug(["---SWFUpload Instance Info---\n","Version: ",SWFUpload.version,"\n","Movie Name: ",this.movieName,"\n","Settings:\n","	","upload_url:               ",this.settings.upload_url,"\n","	","flash_url:                ",this.settings.flash_url,"\n","	","use_query_string:         ",this.settings.use_query_string.toString(),"\n","	","requeue_on_error:         ",this.settings.requeue_on_error.toString(),"\n","	","http_success:             ",this.settings.http_success.join(", "),"\n","	","assume_success_timeout:   ",this.settings.assume_success_timeout,"\n","	","file_post_name:           ",this.settings.file_post_name,"\n","	","post_params:              ",this.settings.post_params.toString(),"\n","	","file_types:               ",this.settings.file_types,"\n","	","file_types_description:   ",this.settings.file_types_description,"\n","	","file_size_limit:          ",this.settings.file_size_limit,"\n","	","file_upload_limit:        ",this.settings.file_upload_limit,"\n","	","file_queue_limit:         ",this.settings.file_queue_limit,"\n","	","debug:                    ",this.settings.debug.toString(),"\n","	","prevent_swf_caching:      ",this.settings.prevent_swf_caching.toString(),"\n","	","button_placeholder_id:    ",this.settings.button_placeholder_id.toString(),"\n","	","button_placeholder:       ",this.settings.button_placeholder?"Set":"Not Set","\n","	","button_image_url:         ",this.settings.button_image_url.toString(),"\n","	","button_width:             ",this.settings.button_width.toString(),"\n","	","button_height:            ",this.settings.button_height.toString(),"\n","	","button_text:              ",this.settings.button_text.toString(),"\n","	","button_text_style:        ",this.settings.button_text_style.toString(),"\n","	","button_text_top_padding:  ",this.settings.button_text_top_padding.toString(),"\n","	","button_text_left_padding: ",this.settings.button_text_left_padding.toString(),"\n","	","button_action:            ",this.settings.button_action.toString(),"\n","	","button_disabled:          ",this.settings.button_disabled.toString(),"\n","	","custom_settings:          ",this.settings.custom_settings.toString(),"\n","Event Handlers:\n","	","swfupload_loaded_handler assigned:  ",("function"==typeof this.settings.swfupload_loaded_handler).toString(),"\n","	","file_dialog_start_handler assigned: ",("function"==typeof this.settings.file_dialog_start_handler).toString(),"\n","	","file_queued_handler assigned:       ",("function"==typeof this.settings.file_queued_handler).toString(),"\n","	","file_queue_error_handler assigned:  ",("function"==typeof this.settings.file_queue_error_handler).toString(),"\n","	","upload_start_handler assigned:      ",("function"==typeof this.settings.upload_start_handler).toString(),"\n","	","upload_progress_handler assigned:   ",("function"==typeof this.settings.upload_progress_handler).toString(),"\n","	","upload_error_handler assigned:      ",("function"==typeof this.settings.upload_error_handler).toString(),"\n","	","upload_success_handler assigned:    ",("function"==typeof this.settings.upload_success_handler).toString(),"\n","	","upload_complete_handler assigned:   ",("function"==typeof this.settings.upload_complete_handler).toString(),"\n","	","debug_handler assigned:             ",("function"==typeof this.settings.debug_handler).toString(),"\n"].join(""))},SWFUpload.prototype.addSetting=function(e,t,i){return this.settings[e]=void 0==t?i:t},SWFUpload.prototype.getSetting=function(e){return void 0!=this.settings[e]?this.settings[e]:""},SWFUpload.prototype.callFlash=function(functionName,argumentArray){argumentArray=argumentArray||[];var movieElement=this.getMovieElement(),returnValue,returnString;try{returnString=movieElement.CallFunction('<invoke name="'+functionName+'" returntype="javascript">'+__flash__argumentsToXML(argumentArray,0)+"</invoke>"),returnValue=eval(returnString)}catch(ex){throw"Call to "+functionName+" failed"}return void 0!=returnValue&&"object"==typeof returnValue.post&&(returnValue=this.unescapeFilePostParams(returnValue)),returnValue},SWFUpload.prototype.selectFile=function(){this.callFlash("SelectFile")},SWFUpload.prototype.selectFiles=function(){this.callFlash("SelectFiles")},SWFUpload.prototype.startUpload=function(e){this.callFlash("StartUpload",[e])},SWFUpload.prototype.cancelUpload=function(e,t){t!==!1&&(t=!0),this.callFlash("CancelUpload",[e,t])},SWFUpload.prototype.stopUpload=function(){this.callFlash("StopUpload")},SWFUpload.prototype.getStats=function(){return this.callFlash("GetStats")},SWFUpload.prototype.setStats=function(e){this.callFlash("SetStats",[e])},SWFUpload.prototype.getFile=function(e){return"number"==typeof e?this.callFlash("GetFileByIndex",[e]):this.callFlash("GetFile",[e])},SWFUpload.prototype.addFileParam=function(e,t,i){return this.callFlash("AddFileParam",[e,t,i])},SWFUpload.prototype.removeFileParam=function(e,t){this.callFlash("RemoveFileParam",[e,t])},SWFUpload.prototype.setUploadURL=function(e){this.settings.upload_url=e.toString(),this.callFlash("SetUploadURL",[e])},SWFUpload.prototype.setPostParams=function(e){
this.settings.post_params=e,this.callFlash("SetPostParams",[e])},SWFUpload.prototype.addPostParam=function(e,t){this.settings.post_params[e]=t,this.callFlash("SetPostParams",[this.settings.post_params])},SWFUpload.prototype.removePostParam=function(e){delete this.settings.post_params[e],this.callFlash("SetPostParams",[this.settings.post_params])},SWFUpload.prototype.setFileTypes=function(e,t){this.settings.file_types=e,this.settings.file_types_description=t,this.callFlash("SetFileTypes",[e,t])},SWFUpload.prototype.setFileSizeLimit=function(e){this.settings.file_size_limit=e,this.callFlash("SetFileSizeLimit",[e])},SWFUpload.prototype.setFileUploadLimit=function(e){this.settings.file_upload_limit=e,this.callFlash("SetFileUploadLimit",[e])},SWFUpload.prototype.setFileQueueLimit=function(e){this.settings.file_queue_limit=e,this.callFlash("SetFileQueueLimit",[e])},SWFUpload.prototype.setFilePostName=function(e){this.settings.file_post_name=e,this.callFlash("SetFilePostName",[e])},SWFUpload.prototype.setUseQueryString=function(e){this.settings.use_query_string=e,this.callFlash("SetUseQueryString",[e])},SWFUpload.prototype.setRequeueOnError=function(e){this.settings.requeue_on_error=e,this.callFlash("SetRequeueOnError",[e])},SWFUpload.prototype.setHTTPSuccess=function(e){"string"==typeof e&&(e=e.replace(" ","").split(",")),this.settings.http_success=e,this.callFlash("SetHTTPSuccess",[e])},SWFUpload.prototype.setAssumeSuccessTimeout=function(e){this.settings.assume_success_timeout=e,this.callFlash("SetAssumeSuccessTimeout",[e])},SWFUpload.prototype.setDebugEnabled=function(e){this.settings.debug_enabled=e,this.callFlash("SetDebugEnabled",[e])},SWFUpload.prototype.setButtonImageURL=function(e){void 0==e&&(e=""),this.settings.button_image_url=e,this.callFlash("SetButtonImageURL",[e])},SWFUpload.prototype.setButtonDimensions=function(e,t){this.settings.button_width=e,this.settings.button_height=t;var i=this.getMovieElement();void 0!=i&&(i.style.width=e+"px",i.style.height=t+"px"),this.callFlash("SetButtonDimensions",[e,t])},SWFUpload.prototype.setButtonText=function(e){this.settings.button_text=e,this.callFlash("SetButtonText",[e])},SWFUpload.prototype.setButtonTextPadding=function(e,t){this.settings.button_text_top_padding=t,this.settings.button_text_left_padding=e,this.callFlash("SetButtonTextPadding",[e,t])},SWFUpload.prototype.setButtonTextStyle=function(e){this.settings.button_text_style=e,this.callFlash("SetButtonTextStyle",[e])},SWFUpload.prototype.setButtonDisabled=function(e){this.settings.button_disabled=e,this.callFlash("SetButtonDisabled",[e])},SWFUpload.prototype.setButtonAction=function(e){this.settings.button_action=e,this.callFlash("SetButtonAction",[e])},SWFUpload.prototype.setButtonCursor=function(e){this.settings.button_cursor=e,this.callFlash("SetButtonCursor",[e])},SWFUpload.prototype.queueEvent=function(e,t){void 0==t?t=[]:t instanceof Array||(t=[t]);var i=this;if("function"==typeof this.settings[e])this.eventQueue.push(function(){this.settings[e].apply(this,t)}),setTimeout(function(){i.executeNextEvent()},0);else if(null!==this.settings[e])throw"Event handler "+e+" is unknown or is not a function"},SWFUpload.prototype.executeNextEvent=function(){var e=this.eventQueue?this.eventQueue.shift():null;"function"==typeof e&&e.apply(this)},SWFUpload.prototype.unescapeFilePostParams=function(e){var t,i=/[$]([0-9a-f]{4})/i,o={};if(void 0!=e){for(var s in e.post)if(e.post.hasOwnProperty(s)){t=s;for(var a;null!==(a=i.exec(t));)t=t.replace(a[0],String.fromCharCode(parseInt("0x"+a[1],16)));o[t]=e.post[s]}e.post=o}return e},SWFUpload.prototype.testExternalInterface=function(){try{return this.callFlash("TestExternalInterface")}catch(e){return!1}},SWFUpload.prototype.flashReady=function(){var e=this.getMovieElement();return e?(this.cleanUp(e),void this.queueEvent("swfupload_loaded_handler")):void this.debug("Flash called back ready but the flash movie can't be found.")},SWFUpload.prototype.cleanUp=function(e){try{if(this.movieElement&&"unknown"==typeof e.CallFunction){this.debug("Removing Flash functions hooks (this should only run in IE and should prevent memory leaks)");for(var t in e)try{"function"==typeof e[t]&&(e[t]=null)}catch(i){}}}catch(o){}window.__flash__removeCallback=function(e,t){try{e&&(e[t]=null)}catch(i){}}},SWFUpload.prototype.fileDialogStart=function(){this.queueEvent("file_dialog_start_handler")},SWFUpload.prototype.fileQueued=function(e){e=this.unescapeFilePostParams(e),this.queueEvent("file_queued_handler",e)},SWFUpload.prototype.fileQueueError=function(e,t,i){e=this.unescapeFilePostParams(e),this.queueEvent("file_queue_error_handler",[e,t,i])},SWFUpload.prototype.fileDialogComplete=function(e,t,i){this.queueEvent("file_dialog_complete_handler",[e,t,i])},SWFUpload.prototype.uploadStart=function(e){e=this.unescapeFilePostParams(e),this.queueEvent("return_upload_start_handler",e)},SWFUpload.prototype.returnUploadStart=function(e){var t;if("function"==typeof this.settings.upload_start_handler)e=this.unescapeFilePostParams(e),t=this.settings.upload_start_handler.call(this,e);else if(void 0!=this.settings.upload_start_handler)throw"upload_start_handler must be a function";void 0===t&&(t=!0),t=!!t,this.callFlash("ReturnUploadStart",[t])},SWFUpload.prototype.uploadProgress=function(e,t,i){e=this.unescapeFilePostParams(e),this.queueEvent("upload_progress_handler",[e,t,i])},SWFUpload.prototype.uploadError=function(e,t,i){e=this.unescapeFilePostParams(e),this.queueEvent("upload_error_handler",[e,t,i])},SWFUpload.prototype.uploadSuccess=function(e,t,i){e=this.unescapeFilePostParams(e),this.queueEvent("upload_success_handler",[e,t,i])},SWFUpload.prototype.uploadComplete=function(e){e=this.unescapeFilePostParams(e),this.queueEvent("upload_complete_handler",e)},SWFUpload.prototype.debug=function(e){this.queueEvent("debug_handler",e)},SWFUpload.prototype.debugMessage=function(e){if(this.settings.debug){var t,i=[];if("object"==typeof e&&"string"==typeof e.name&&"string"==typeof e.message){for(var o in e)e.hasOwnProperty(o)&&i.push(o+": "+e[o]);t=i.join("\n")||"",i=t.split("\n"),t="EXCEPTION: "+i.join("\nEXCEPTION: "),SWFUpload.Console.writeLine(t)}else SWFUpload.Console.writeLine(e)}},SWFUpload.Console={},SWFUpload.Console.writeLine=function(e){var t,i;try{t=document.getElementById("SWFUpload_Console"),t||(i=document.createElement("form"),document.getElementsByTagName("body")[0].appendChild(i),t=document.createElement("textarea"),t.id="SWFUpload_Console",t.style.fontFamily="monospace",t.setAttribute("wrap","off"),t.wrap="off",t.style.overflow="auto",t.style.width="700px",t.style.height="350px",t.style.margin="5px",i.appendChild(t)),t.value+=e+"\n",t.scrollTop=t.scrollHeight-t.clientHeight}catch(o){alert("Exception: "+o.name+" Message: "+o.message)}},Box.Timing.execution.push({name:"js/services/amsterdam/uploads/uploads-sha1-worker.js",time:(new Date).getTime()}),Box.Application.addService("uploads-sha1-worker",function(){"use strict";return{isInlineWorkerSupported:function(){function e(){}try{var t=this.createBlobFromFunction(e),i=(URL||webkitURL).createObjectURL(t),o=new Worker(i);return o.terminate(),(URL||webkitURL).revokeObjectURL(i),!0}catch(s){return!1}},createBlobFromFunction:function(e){return new Blob(["("+e.toString()+").call()"],{type:"text/javascript"})},createWorker:function(){function e(){function e(){function e(e){if("string"==typeof e)return t(e);var o=e.length;c+=8*o;for(var s=0;o>s;s++)i(e[s])}function t(e){var t=e.length;c+=8*t;for(var o=0;t>o;o++)i(e.charCodeAt(o))}function i(e){r[p]|=(255&e)<<h,h?h-=8:(p++,h=24),16===p&&s()}function o(){i(128),(p>14||14===p&&24>h)&&s(),p=14,h=24,i(0),i(0),i(c>0xffffffffff?c/1099511627776:0),i(c>4294967295?c/4294967296:0);for(var e=24;e>=0;e-=8)i(c>>e);return a(n)+a(l)+a(_)+a(d)+a(u)}function s(){for(var e=16;80>e;e++){var t=r[e-3]^r[e-8]^r[e-14]^r[e-16];r[e]=t<<1|t>>>31}var i,o,s=n,a=l,h=_,c=d,f=u;for(e=0;80>e;e++){20>e?(i=c^a&(h^c),o=1518500249):40>e?(i=a^h^c,o=1859775393):60>e?(i=a&h|c&(a|h),o=2400959708):(i=a^h^c,o=3395469782);var m=(s<<5|s>>>27)+i+f+o+(0|r[e]);f=c,c=h,h=a<<30|a>>>2,a=s,s=m}for(n=n+s|0,l=l+a|0,_=_+h|0,d=d+c|0,u=u+f|0,p=0,e=0;16>e;e++)r[e]=0}function a(e){for(var t="",i=28;i>=0;i-=4)t+=(e>>i&15).toString(16);return t}var r,n=1732584193,l=4023233417,_=2562383102,d=271733878,u=3285377520,p=0,h=24,c=0;return r=new Uint32Array(80),{update:e,digest:o}}var t=65536,i=e();self.onmessage=function(o){try{var s=o.data,a=s.type;if("part"===a){for(var r=s.file,n=s.part,l=n.offset+n.size,_=new FileReaderSync,d=e(),u=n.offset;l>u;u+=t){var p=Math.min(t,l-u),h=r.slice(u,u+p),c=_.readAsBinaryString(h);d.update(c),i.update(c)}if(s.part.sha1=d.digest(),postMessage({type:"partDone",part:n}),l===r.size){var f=i.digest();postMessage({type:"done",sha1:f})}}}catch(m){postMessage({type:"error",message:m.toString()})}}}var t=this.createBlobFromFunction(e),i=(window.URL||window.webkitURL).createObjectURL(t),o=new Worker(i);return o.oldTerminate=o.terminate,o.terminate=function(){(window.URL||window.webkitURL).revokeObjectURL(i),o.oldTerminate()},o}}}),Box.Timing.execution.push({name:"done",time:(new Date).getTime()});
//# sourceMappingURL=/js/section_uploader.js.map