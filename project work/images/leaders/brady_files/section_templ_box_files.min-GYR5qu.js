function init_box_components(){var e=Box.Application,t=e.getService("v5"),i=t.get("Canvas");i.expanded_list_view=window.expanded_list_view,i.view=window.list_view?"expanded":"icon";var a=e.getService("cookies"),n=e.getService("loading"),o=e.getService("nav-state"),s="undefined"!=typeof window.first_load;e.broadcast("viewchange",{view:i.view,firstLoad:s}),o.isEmbedWidget()||t.get("Box_Menus").add_menu_to_group(t.get("Quick_Search"),"header");var r=window.location.href,l=a.get("wlh");l&&("undefined"!=typeof Tombstone&&Tombstone.marker("js/box_files.js:72","2015-07-20","auto tombstoned"),r=l,"#"===r.charAt(0)&&("undefined"!=typeof Tombstone&&Tombstone.marker("js/box_files.js:73","2015-07-20","auto tombstoned"),r=l.substr(1)),a.remove("wlh")),e.navigate(r,{},{preloadedResults:window.first_load,no_loading:!0});var d=t.get("Item");new d({type:"folder",id:d.TRASH_FOLDER_ID,name:$t("Trash","js_myfiles_title_trash"),user_is_owner:!0,granted_permissions:{view:!0}}),$(".body").on("contextmenu",function(e){return box.is_ignoring_right_click(e.target)?!0:"undefined"==i.current_folder.permissions.upload||i.current_folder.permissions.upload||"undefined"==i.current_folder.permissions.share||i.current_folder.permissions.share?(n.isBlocking()||Box_Menus.get().menu.show({event:e,item:i.current_folder,type:"containing_folder"}),!0):!1}),window.shared_link_access_denied&&e.getService("notifications").error($t("The item you are trying to access has either been deleted or is unavailable to you.","item_unavailable_to_you_all_files"))}function init_box_files(){init_first_load(),init_box_components()}function init_first_load(){var e=Box.Application.getService("unidb");e.isUniDB(window.first_load)&&(window.first_load=e.decode(window.first_load))}var gallery_page="files",Box_Files=Base.extend({after_load_callback:null,after_search_callback:null,current_folder:null,first_click:!0,hist_name:"files",path:null,path_html:null,pending_collab:null,search_filter:null,search_total_results_count:null,latest_request_time:null,navigation_shortcuts_enabled:!0,nav_element:null,load:function(e){var t=Box.Application,i=t.getService("nav-state"),a=i.get();return box.immediate_items_display(e.html),box._store_data(e),box.set_canvas_state(e),e.is_deleted&&(a.id!=e.user_root_folder&&(i.setItemInFiles(0),t.navigate("",{},{load_deleted_item:!0})),e.required_pending_collab||t.getService("notifications").error($t("The item you are trying to access has either been deleted or is unavailable to you.","item_unavailable_to_you_all_files")),e.rejected_collab)?void t.getService("notifications").error($t("You have already rejected this invitation.","collaboration_rejected_already")):e.required_pending_collab?void box._prompt_accept_collab(e.required_pending_collab):(e.theme_html&&Theme.apply_theme(e),box._post_display(e),void(box.keyboard_navigation_enabled()&&box.initialize_nav_element()))},_store_data:function(e){var t=Box.Application,i=t.getService("logger"),a=t.getService("nav-state"),n=Canvas.get();if(a.setSort(e.sort,e.sort_direction),box.path=e.path||!1,box.path_html=e.path_html||!1,box.pending_collab=e.pending_collab||!1,n.users.set_params(e.users),n.group_tags.set_params(e.group_tags),n.tags=e.tags||Canvas.get().tags,"number"==typeof e.total_count){if(box.search_total_results_count=e.total_count,0===e.total_count){var o=(new Date).getTime(),s={search_string:$j.trim($("#search").val()),created_at:o};i.sendLog("search","SEARCH_NO_RESULTS",s)}}else box.search_total_results_count=null},_get_canvas_load_params:function(e,t){var i=Box.Application.getService("nav-state"),a=i.get(),n={automationRetentionHTML:e.automationRetentionHTML,background:t||!1,collaborated:e.folder_info?e.folder_info.collaborated:0,current_page:a.page+1,folder:e.folder_info||{},items_html:e.html,predisplay_items_html:!0,nodes:e.nodes,permissions:e.folder_info?e.folder_info.permissions:{},use_item_expansion:{share:!0,comments:!0,tasks:!0},use_selectables:!0,use_dragdrop:!0,file_view:i.isShowingFiles()};return n.nodes||(n.nodes=e.items),n},set_canvas_state:function(e){var t=Box.Application.getService("nav-state"),i=(t.get(),box._get_canvas_load_params(e,!1)),a=Canvas.get();a.reset(),a.load(i)},pagination_callback:function(e){var t=Box.Application,i=t.getService("nav-state");return i.set({page:e-1}),t.navigate(""),!1},_post_display:function(e){var t=Canvas.get(),i=Box.Application,a=i.getService("nav-state"),n=a.get();box._set_document_title(),t.init_pages(e,this.pagination_callback),box._display_initial_confirmation_messages(e);var o=Box_Confirmation_Message.get().is_confirmation_visible();!a.isRootFolder()||n.isGallery||o||box._show_notifications(),a.isEmbedWidget()||this._display_sidebar(e.sidebar_html,e.sharing_sidebar_html),e.is_deleted&&i.getService("notifications").error($t("The item you are trying to access has either been deleted or is unavailable to you.","item_unavailable_to_you_all_files")),t.fix_page_ui_issues(),i.getService("loading").set(!1)},_display_sidebar:function(e,t){var i=Box.Application,a=i.getService("v5"),n=i.getService("dom"),o=i.getService("nav-state"),s=o.isSearch(),r=o.isTrash(),l=o.isRootFolder(),d=o.isTag(),c=a.get("Box_Sidebar_View"),_=this._isBrowserLteIE8();if(!_){var m=n.query(".collab-sidebar-placeholder"),h=n.query("#mod-collab-sidebar");!h||l||r||s||d||n.hasClass(m,"hidden")||(e=this._getModifiedCollabPlaceholder(e,h))}c.populate_html(e,t),s?(c.hideSidebarCollabPlaceholder(),c.hideSidebarShareModule(),c.displaySidebarSearchModule(),c.hideSidebarMiscFilesModules()):(c.displaySidebarCollabOverlay(),c.displaySidebarShareModule(),c.displaySidebarMiscFilesModules(),c.hideSidebarSearchModule(),c.show_sidebar_collaborators_module()),box_sidebar.show_sidebar(),Box.Application.getService("imageloader").loadImages(document.getElementById("content_sidebar"),!0)},_isBrowserLteIE8:function(){var e=Box.Application.getService("browser"),t=e.getVersion();return e.isIE()&&Math.floor(parseFloat(t))<=8},_getModifiedCollabPlaceholder:function(e,t){var i,a,n=Box.Application.getService("dom"),o=document.createElement("div"),s=$(o);return s.html(e),i=$(n.query("#collab_module_container",o)),0===i.length?e:(a=n.query(".sidebar-collab-spinner-container"),n.removeClass(a,"hidden"),n.addClass(a,"is-displayed"),i.html(""),i[0].appendChild(t),s.html())},_set_document_title:function(){var e=Box.Application,t=e.getService("v5"),i=t.get("Canvas"),a=e.getService("nav-state"),n=a.get();document.title=i.current_folder.name?(n.id==window.root_folder_id.substr(2)?$t("All files and folders","all_files_and_folders"):i.current_folder.name)+" - Box":"Box"},_prompt_accept_collab:function(e){var t=Box.Application,i=t.getService("nav-state"),a=i.get();return t.getService("loading").set(!1),first_load=!1,e=new Collab(e),e.accept({task_id:a.subId,required_accept_options:!0,needs_accept:!0}),!1},immediate_items_display:function(e){var t=Box.Application.getService("dom");t.setHTML($("#item-list")[0],e)},_display_initial_confirmation_messages:function(e){var t=Box_Confirmation_Message_Builder.get(),i=Box.Application.getService("url");if(e.pending_collab&&t.show_collaboration_invite_message(e.pending_collab),e.master_invites&&e.master_invites.length){for(var a=$j("<div/>"),n=0;n<e.master_invites.length;n++){var o=e.master_invites[n],s=$j("#tpl_master_invite").clone().removeAttr("id");s.find("#enterprise_invite_network_name").text(o.public_name),s.find("#master_invite_id").attr("id",o.master_invite_id),s.css("display","block"),a.append(s)}t.show_master_invite_message(a.html())}e.grace_notify?("undefined"!=typeof Tombstone&&Tombstone.marker("js/box_files.js:39","2015-07-20","auto tombstoned"),t.show_grace_notification_message()):window.sso_groups_exceeded?t.show_sso_groups_exceeded_message():e.collab_by_link_unsuccessful?t.show_collab_by_link_unsuccessful_message():"added_email_alias"==i.getQueryParams(window.location.href).banner?t.show_added_email_alias_message(i.getQueryParams(window.location.href).email):e.folder_info.show_expiration_notice&&t.show_temporary_access_message(e.folder_info.show_expiration_notice.execute_at,e.folder_info.show_expiration_notice.collab_id)},_accept_collab_callback:function(e,t,i,a){var n=this,o=t.item_type,s=Item.find_or_create({type:o,id:t.item_id}),r=$t("Accepted","accepted_collab_invitation");if(i){var l=$t("Go to file","go_to_file"),d="/files/0/f/0/1/f_"+t.item_id;"folder"===o?(l=$t("Go to folder","go_to_folder"),d=s.build_url()):t.item_name&&".boxnote"===t.item_name.slice(-8)&&(l=$t("Go to Box Note","accept_collab_callback_go_to_boxnote"),d="/notes/"+t.item_id),r+=': <a href="'+d+'" target="_blank">'+l+"</a>"}else{var c;a?c=a:("undefined"!=typeof Tombstone&&Tombstone.marker("js/box_files.js:49","2015-07-20","auto tombstoned"),c=$t("You no longer have permission to collaborate on this folder.","accepted_collab_invitation_failed_tooltip")),r="<strong>"+$t("Failed to accept this collaboration.","accepted_collab_invitation_failed")+'</strong><span class="sprite_16x16_info list_img list_img_icon_16" data-hover="tooltip" aria-label="'+c+'">&nbsp;</span>'}e.html(r),i&&s.refresh(n._update_item_display_on_files_page,{skip_render:!0})},_show_notifications:function(){var e="/index.php?rm=box_notifications_show_notifications";$j.getJSON(e,function(e){var t=e.auto_collaborated_counts;if(e.app_folder_invites_html){var i=$t("Your documents have been uploaded into:","app_folder_invite_notification_header");Box_Confirmation_Message.get().show_confirmation(i,{description:e.app_folder_invites_html})}else t&&Box_Confirmation_Message_Builder.get().show_auto_collaboration_message(t.folders,t.files,e.auto_collaborated_items_html)})},_update_item_display_on_files_page:function(e,t){t&&$j("#empty").hide();var i=$j(t);$j("#item-list").prepend(i),e.element=i[0],e.render({init:!1,file_view:!0,force_render_tags:!0,force_render_classes:!0})},_reload_page:function(){document.location.reload()},master_invite_answer:function(e,t){var i=$j(e).parent().attr("id"),a={master_invite_id:i,status:t},n=this,o=$j.box.formatQuery(a),s="/index.php?rm=box_master_users_unlinked_boxes_invite_answer";$j.postJSON(s,o,function(e){var i=Box.Application,a=i.getService("notifications");if(a.hide(),e.success&&"accepted"===t)n._reload_page();else if(!e.success){var o="";"accepted"===t?o=$t("There was an issue accepting Enterprise invite.  Please contact the administrator.","master_invite_accept_failed"):("undefined"!=typeof Tombstone&&Tombstone.marker("js/box_files.js:63","2015-07-20","auto tombstoned"),o=$t("There was an issue rejecting Enterprise invite.  Please contact the administrator.","master_invite_reject_failed")),a.error(o)}})},reload:function(e,t){"undefined"!=typeof Tombstone&&Tombstone.marker("js/box_files.js:64","2015-07-20","auto tombstoned");var i=Box.Application,a=i.getService("nav-state");"f"!=t||!e||"d"!=e.substr(0,1)&&"f"!=e.substr(0,1)||(e=e.substr(2)),a.setItemInFiles(e),i.navigate("")},initialize_nav_element:function(){this.nav_element=$("#item-list li:first").addClass("nav_selected")},keyboard_navigation_enabled:function(){return null!=this.nav_element},is_ignoring_right_click:function(e){e=$j(e);var t=e.is("a, input[type=text], textarea, .allow_right_click"),i=!!e.parents(".drop_down_ext, .drop_down").length;return i||t}},{get:function(){return Box_Files.__instance||(Box_Files.__instance=new Box_Files),Box_Files.__instance}}),box=Box_Files.get();Loader.t3Loaded.done(function(){"undefined"==typeof sinon&&init_box_files()});var Theme=Box_Object.extend({},{type:"theme",color_schemes:{},pic_types:{},init:function(){this.color_schemes=window.color_schemes||this.color_schemes,this.pic_types=window.theme_pic_types||this.pic_types},get_color_scheme_by_id:function(e){return"custom"==e?{id:"custom"}:Theme.color_schemes[e]},reset_theme:function(){$j("#box_custom_theme_common_css").remove(),$j("#box_custom_theme_sprite_common_css").remove(),window.theme_id=default_theme_id},apply_theme:function(e){var t=e.theme;if(e.theme_html&&""!=e.theme_html&&(this.reset_theme(),$j("#theme_preview_placeholder").empty().unsafeAppend(e.theme_html),t)){theme_id=t.theme_id,theme_id==default_theme_id||!t.pic_urls||"undefined"!=typeof t.pic_urls.small&&null===t.pic_urls.small?($j("#themed_main_logo").hide(),$j("#default_main_logo, #default_main_logo_glow").show(),t.use_contrast_logo?$j("#default_main_logo, #default_main_logo_glow").addClass("contrast-logo"):$j("#default_main_logo, #default_main_logo_glow").removeClass("contrast-logo")):($j("#default_main_logo, #default_main_logo_glow").hide(),$j("#themed_main_logo").html('<img class="logo" src="'+t.pic_urls.small+'">').show());var i=t.custom_support_url,a=t.custom_support_phone;if(""==i&&(i=Box_Contact_Info.get().get_contact_info("support","url")),$j("#footer_help_link").attr("href",i),$j("#current_user_help a").attr("href",i),t.footer_text||t.footer_link_text)$j("#box_footer").empty().append($.box.escapeHTML(t.footer_text)+' <a href="'+$.box.escapeHTML(t.footer_link_url)+'" class="lowlight" target="_blank">'+$.box.escapeHTML(t.footer_link_text)+"</a>");else if(a){var n=$t("Support:","default_footer_note")+" ",o=$('<strong class="support_phone"></strong>'),s=$("<div>");o.text(a),s.attr("href",i).text(n).append(o),$j("#box_footer").empty().html(s)}t.in_product_marketing_text&&$j("#sidebar_in_product_marketing").text(t.in_product_marketing_text)}}}),Folder_Membership_Permission_Menu=Abstract_Menu.extend({constructor:function(e){e=e||{},this._j_menu=$("#folder_membership_permission_menu"),this._e_menu=this._j_menu.get(0),this._select_callback_passed_from_caller=e.select_callback,this.select_item(e.permission)},show:function(e){e=e||{},this._j_target_element=$j(e.target),this.base()},_render:function(e){this._j_menu.show()},select_item:function(e){this._j_menu.find(".selected").removeClass("selected"),$j("#folder_permission_"+e).parent().addClass("selected")},event_click:function(e){var t=$j(e.target),i=t.attr("id");this.select_item(i.substring("folder_permission_".length));var a=t.text();return this._select_callback_passed_from_caller&&this._select_callback_passed_from_caller(a),this.hide(),!1}},{});Box.Application.addService("search",function(e){"use strict";function t(e){var t,i="";return $.isArray(e.filters)&&(i=u.getSearchStringFromFilters(e.filters)),t={page_num:e.page_num,page_size:e.page_size,theme_id:e.theme_id,sort:e.sort,direction:e.direction,view:e.view,search:e.query,filter_list:i,mdfilters:e.mdfilters,resin_session_id:e.resin_session_id}}function i(e){return"/index.php?rm="+e}function a(e,t,a){var n,o,s,r;return t.search&&e?(a?(n=$.Deferred(),n.resolve(a),o=n.promise()):(r=i(e),s=$.box.formatQuery(t),o=$.getJSON(r,s)),o):$.Deferred().reject().promise()}function n(e,t,i,a,n,o){return e+";$s%"+t+";$x%"+i+";$r%"+a+";$F%"+n+";$m%"+o}function o(e){var t;"object"!=typeof e||u.isGcm()||(t=n(e.to_search,e.current_page,e.sort,e.sort_direction,e.filter_list,e.mdfilters),h[t]=e,h[t].timestamp=new Date)}function s(e){var t=h[e],i=new Date;return t&&t.timestamp?i-t.timestamp>f:!0}function r(){for(var e in h)h.hasOwnProperty(e)&&s(e)&&delete h[e]}function l(t){var i=(new Date).getTime(),a={search_string:t.search,created_at:i,resin_session_id:e.getService("resin").getSessionId()},n=e.getService("logger");n.sendLog("search","SEARCH_FULL_SEARCH_START",a)}function d(t,i){var a=e.getService("logger");t=t||{},i=i||!1,_=new Date,m=_-c,a.sendLog("search_performance","END_USER_ALL_FILES",{search_completion_time:m,page_size:t.page_size,total_count:t.total_count,cache_hit:i})}var c,_,m,h={},u=e.getService("nav-state"),f=6e4;return{execute:function(i){var s,_,m,f,p,g=!1;c=new Date,i=i||{},i.filters=i.filters||[],i.callback=i.callback||function(){},p=i.mdfilters?JSON.parse(i.mdfilters):{},e.broadcast("x-searchbefore",{query:i.query,filters:i.filters,mdfilters:p,isPreloaded:!!i.preloadedResults}),s=t(i),u.isGcm()||(r(),m=n(s.search,s.page_num,s.sort,s.direction,s.filter_list,s.mdfilters),f=h[m],"object"==typeof f&&(i.preloadedResults=f,g=!0)),_=a(i.runmode,s,i.preloadedResults),_.done(o).done(i.callback).done(function(t){e.broadcast("x-searchafter",{json:t})}).done(function(e){d(e,g)}),l(s);var v=e.getGlobal("window");v.scrollTo(0,0)},clearCache:function(){h={}}}}),Box.Application.addService("animations",function(e){"use strict";function t(e,t,i,a,n,o){var s,r,l;l=$(e),s={height:t,opacity:i},r={duration:n||"slow",easing:o||"linear",complete:a||null},l.stop().animate(s,r)}return{closeElement:function(e,i,a,n,o,s){i=i||"hide",a=a||0,t(e,i,a,n,o,s)},openElement:function(e,i,a,n,o,s){i=i||"show",a=a||1,t(e,i,a,n,o,s)}}}),Box.Application.addBehavior("share-access-menu",function(e){"use strict";function t(e){var t='[data-access-id="'+e+'"]',i=m.query(t,_);m.addClass(i,"selected")}function i(e,t){var i,a;t[g]||(i='[data-access-id="'+g+'"]',a=m.query(i,_),m.addClass(a,"hidden")),e&&t[v]||(i='[data-access-id="'+v+'"]',a=m.query(i,_),m.addClass(a,"hidden")),t[b]||(i='[data-access-id="'+b+'"]',a=m.query(i,_),m.addClass(a,"hidden"))}function a(e){var t=m.query(".company-access-text",_),i=$t("People in %1","share_access_menu_company_with_name",e);m.setHTML(t,i)}function n(){c&&(c.destroy(),c=null),_&&_.parentNode.removeChild(_),_=null}function o(o,s,r,l,d,h){c&&n();var u=e.getService("templates"),f=u.getTemplateFragment("share-access-menu",{itemTypedId:h});_=m.getFirstElementChild(f),i(r,l),t(s),d&&a(d);var p=m.getNearest(o,".item");p?p.insertBefore(f,p.firstChild):o.parentNode.appendChild(f),c=e.getService("menus").create(_),c.init()}function s(t,i){var a=h.getGcmCompatibleRmUrl(f),n={itemTypedId:i,accessLevel:t};e.broadcast("sharedlinkchangeinitiated",{itemTypedId:i,context:u}),$.postJSON(a,n,function(a){a.success?e.broadcast("sharedlinkchanged",{newAccessLevel:t,itemTypedId:i,context:u}):e.broadcast("sharedlinkchangeerror",{itemTypedId:i,context:u})})}function r(t){var i=h.getGcmCompatibleRmUrl(p),a={itemTypedId:t};e.broadcast("sharedlinkchangeinitiated",{itemTypedId:t,context:u}),$.postJSON(i,a,function(i){i.success?e.broadcast("sharedlinkremoved",{itemTypedId:t,context:u}):e.broadcast("sharedlinkchangeerror",{itemTypedId:t,context:u})})}function l(t){var i=e.getService("popups");i.confirm($t("This will permanently remove the shared link. If this item is embedded on other sites it will also become inaccessible. Any custom properties, settings and expirations will be removed as well. Do you want to continue?","share_access_menu_remove_link_message"),{onconfirm:function(){r(t),i.close()},confirmText:$t("Continue","js_popup_button_continue"),isBlocking:!0})}function d(e){var t,i=e.length,a=[];for(t=0;i>t;t++)a[t]=!!parseInt(e.charAt(t),10);return a}var c,_,m,h,u,f="box_share_item_change_access_level",p="box_share_item_disable_link",g="0",v="1",b="2",y="remove",x="bottom",w={x:-15,y:10},k={x:-21,y:10},S=223,I=63;return{init:function(){m=e.getService("dom"),h=e.getService("url"),e.getConfig()&&(u=e.getConfig().context)},destroy:function(){n(),m=null},messages:[],getItemTypedId:function(e){return e.getAttribute("data-item-typed-id")},onclick:function(e,t,i){if(t&&!m.hasClass(t,"disabled")){var a=parseInt(t.getAttribute("data-access-id"),10);if(a>=0){switch(i){case"access-menu-btn":var n=this.getItemTypedId(t);c&&c.isOpen()?this.hideMenu():this.showMenu(t,a,n);break;default:return}e.preventDefault(),e.stopPropagation()}}},handleAccessLevelChange:function(e,t,i){if(e&&!m.hasClass(e,"disabled")){switch(t){case g:case v:case b:this.changeAccessLevel(t,i);break;case y:this.removeSharedLink(i)}this.hideMenu(),m.removeClass(Item.find(i).element,"hover")}},changeAccessLevel:function(e,t){s(e,t)},removeSharedLink:function(e){l(e)},bindMenuSelectEvent:function(){var e=this;c.on("menuselect",function(t){var i=t.data.targetElement;e.handleAccessLevelChange(i,i.getAttribute("data-access-id"),i.getAttribute("data-item-typed-id"))})},unbindMenuSelectEvent:function(){c.off("menuselect")},showMenu:function(e,t,i){var a=d(e.getAttribute("data-access-levels")),n=!!e.getAttribute("data-enterprise-owned"),s=e.getAttribute("data-enterprise-name");if(!(0>t)){o(e,t,n,a,s,i),this.bindMenuSelectEvent();var r={};r=m.getNearest(e,".item")?w:k,c.showWithBeak(e,x,r,S,I)}},hideMenu:function(){c.hide(),this.unbindMenuSelectEvent(),n()}}}),Box.Application.addModule("item-list",function(e){"use strict";function t(e){var t=$(e),i=t.offset(),a=$(window);return i.top+t.height()>a.height()+a.scrollTop()||i.top<a.scrollTop()+50}function i(e,i){i.length&&(e.removeClass("nav_selected"),i.addClass("nav_selected"),box.nav_element=i,t(i)&&$("html, body").scrollTop(i.offset().top-$(window).height()/2))}function a(e){var t=[],i=0,a=e.size(),n=e.items;for(i=0;a>i;i++)t.push(n[i].typed_id);return t}function n(){return[{key:"c",handler:function(){x.selection.collection.move()}},{key:"m",handler:function(){x.selection.collection.move()}},{key:"d",handler:function(){x.selection.collection.download()}},{key:"t",handler:function(){x.selection.collection.tag()}},{key:"s",handler:function(){if(!k.isTrash()){var e=a(x.selection.collection);e.length&&b.open("show_multi_items_share",{data:{itemTypedIds:e}})}}},{key:"j",handler:function(){if(box.keyboard_navigation_enabled()){var e=box.nav_element,t=e.nextAll("li.item:first");i(e,t)}else box.initialize_nav_element()}},{key:"k",handler:function(){if(box.keyboard_navigation_enabled()){var e=box.nav_element,t=e.prevAll("li.item:first");i(e,t)}else box.initialize_nav_element()}},{key:"x",handler:function(){if(box.keyboard_navigation_enabled()){var e=new $.Event("click",{button:0});box.nav_element.find(".select").trigger(e)}}},{key:"o",handler:function(){if(box.keyboard_navigation_enabled()){var e=new $.Event("click",{button:0,originalEvent:{pageX:0}});box.nav_element.trigger(e)}}},{key:"#",handler:function(){x.selection.collection.delete_me()}},{key:"a",comboKey:"shift+8",handler:function(){x.selection.select_all()}},{key:"n",comboKey:"shift+8",handler:function(){x.selection.unselect_all()}}]}function o(e){var t='li.item[data-typed-id="'+e+'"]';return!!m.query(t,u[0])}function s(e){var t=e.nodes,i=e.items,a=t&&t.length>0,n=i&&i.length>0;return!a&&!n}function r(){var e=m.query("#item-list",u);return 0===e.childNodes.length}function l(){var e=p.find(".upload_button");e&&e.length>0&&y.add_trigger({element:e,folder:x.current_folder,over_callback:function(){e.addClass("hover")},out_callback:function(){e.removeClass("hover")},handle_change:function(e,t){y.handle_change(e,t)}})}function d(e){p.show(),p.find(".empty").hide(),$(e).show(),l()}function c(){p.hide(),p.find("#empty_files").empty()}var _,m,h,u,f,p,g,v,b,y,x,w,k;return{messages:["x-searchbefore","x-folderchangeafter","x-itemrefresh","x-embedsetupdone","viewchange","x-searchafter","x-uploadstarted","x-uploadcanceled","x-uploadupdate","x-newversionupload","sharedlinkcreated","sharedlinkchanged","sharedlinkchangeinitiated","sharedlinkremoved","sharedlinkchangeerror","itemupdated","retentionextended"],behaviors:["item","share-access-menu","create-box-note","tooltips-amsterdam"],init:function(){_=e.getService("v5"),m=e.getService("dom"),v=e.getService("hotkeys"),b=e.getService("popups"),k=e.getService("nav-state"),h=e.getService("imageloader"),w=e.getService("resin"),y=_.get("Upload_Process"),u=$(e.getElement()),p=$(m.query("#empty-placeholder",u[0])),f=m.query("#item-list",u[0]),g={},x=_.get("Canvas"),k.isEmbedWidget()||v.setConfig(n(),"files",!0)},destroy:function(){this.resetFakeItems()},onmessage:function(t,i){var a,n=_.get("Item"),s=e.getService("notifications"),l="";switch(t){case"x-searchbefore":i.isPreloaded||(u.find("#item-list").empty(),i.query&&i.query.length>0?this.showSearchLoading(i.query):this.showEmptySearch()),this.resetFakeItems();break;case"x-searchafter":i.json&&(i.json.item_count>0||i.json.total_count>0)?c():this.showEmptyFiles(),this.resetFakeItems(),this.deferredImageLoader();break;case"x-folderchangeafter":this.handleFolderChangeAfter(i.json),this.deferredImageLoader(i.json.first_load),this.resetFakeItems(),w.recordAction({application:"files",page:w.sanitize(k.getCurrentPageName()),component:"none",feature:"none",target:"loaded",action:"programmatic"});break;case"x-embedsetupdone":u.attr("data-max-item-width")&&this.resizeItemRows(".item");break;case"x-itemrefresh":u.attr("data-max-item-width")&&this.resizeItemRows("#c0_"+i.item.typed_id),this.deferredImageLoader(),r()||this.hideEmptyFiles();break;case"viewchange":this.deferredImageLoader(i.firstLoad),this.resetFakeItems();break;case"x-uploadstarted":this.hideEmptyFiles();break;case"x-uploadupdate":this.updateFakeItem("upl_"+i.item.id,i.item,i.isVisible),this.hideEmptyFiles();break;case"x-newversionupload":i.skipRender||(this.replaceFakeItem("upl_"+i.item.id,i.item,i.html,i.isVisible),this.hideEmptyFiles());break;case"x-uploadcanceled":r()&&(this.showEmptyFiles(),this.resetFakeItems());break;case"sharedlinkcreated":l=i.itemTypedId,o(l)&&(a=n.find(l),a&&a.refresh(),i.context||s.confirm($t("Item successfully shared.","successfully_shared_item")));break;case"sharedlinkchangeinitiated":l=i.itemTypedId,o(l)&&(a=n.find(l),a&&a.itemTray&&a.itemTray.showLoading());break;case"sharedlinkchangeerror":l=i.itemTypedId,o(l)&&(a=n.find(l),a&&a.itemTray&&a.itemTray.hideLoading());break;case"sharedlinkchanged":l=i.itemTypedId,o(l)&&(a=n.find(l),a&&a.refresh(),i.context||i.noConfirmMessage||s.confirm($t("Link to item has been modified.","shared_link_for_item_modified")));break;case"sharedlinkremoved":l=i.itemTypedId,o(l)&&(a=n.find(l),a&&(m.addClass(a.element,"disabled"),a.refresh()),i.context||s.confirm($t("Link to item has been removed.","shared_link_for_item_removed")));break;case"itemupdated":l=i.itemTypedId,o(l)&&(a=n.find(l),a&&a.refresh());break;case"retentionextended":l=i.itemTypedId,o(l)&&(a=n.find(l),a&&a.refresh())}},handleFolderChangeAfter:function(e){s(e)?u.find("#item-list").empty():(u.attr("data-max-item-width")&&this.resizeItemRows(".item"),this.bindFolderUpload()),e&&s(e)?(e.empty_html&&this.setEmptyFilesHTML(e.empty_html),this.showEmptyFiles(),k.isTrash()&&this.showTrashMessage(),this.bindEmptyFolderUpload()):c()},deferredImageLoader:function(t){h.loadImages(e.getElement())},bindFolderUpload:function(){y&&(y.ajax_dnd_dropzone=u)},resizeItemRows:function(e){var t=u.attr("data-max-item-width"),i=u.attr("data-min-tooltip-character-length");u.find(e).each(function(e,a){var n=$(a),o=n.find(".item_name_text"),s=n.find(".description_text_container"),r=n.find(".item_excerpt");o.css("width",t),s.css("width",t),r.css("width",t),i&&o.text().length>i&&o.attr({"data-hover":"tooltip","aria-label":o.text()})})},showEmptyFiles:function(){var t=e.getService("animations"),i=e.getService("browser");d("#empty_files"),t.openElement(u.find(".empty_state_box"),null,null,function(){i.canUseHtml5Dnd()&&u.find(".empty_state_dnd_text").show()})},hideEmptyFiles:function(){var t=e.getService("animations");t.closeElement(p.find(".empty_state_box"),null,null,function(){c()})},showEmptySearch:function(){d("#empty_search")},showSearchLoading:function(e){p.find("#search_pattern").text(e),$(".search_gif_container_disabled").removeClass("search_gif_container_disabled").addClass("search_gif_container"),d("#search_loading")},bindEmptyFolderUpload:function(){var t=e.getService("browser");if(y&&!k.isTrash()&&k.isFiles()){var i=t.canUseHtml5Dnd(),a=x.current_folder.permissions.upload,n=t.canFolderUpload(),o=m.query("#empty-folder-content",u[0]),s="none";if(a){var r=m.query("#zero_state_dnd_box",u[0]),l=null,d=null;i&&(y.add_dnd_handlers(),y.ajax_dnd_dropzone=p),l=function(){m.addClass(r,"dashed_outline_small")},d=function(){m.removeClass(r,"dashed_outline_small")},y.add_trigger({element:r,shouldLogToResin:!0,resinParams:{feature:"emptystate",target:"upload"},over_callback:l,out_callback:d,handle_change:function(e,t){y.handle_change(e,t)}}),s=n?"dnd-folder":i?"dnd":"basic"}if(o){var c=m.query("[data-upload-capability="+s+"]",o);c&&m.removeClass(c,"hidden")}}},setEmptyFilesHTML:function(e){var t=m.query("#empty_files",p[0]);m.setHTML(t,e)},showTrashMessage:function(){var e=p.find("#empty_trash_messages");e.children().hide(),e.find(".default").show().find(".trash_time").text(14)},appendFakeItemToItemList:function(e){var t=m.queryAll(".fake-item",f);t.length?$(t[t.length-1]).after(e):$(f).prepend(e)},createFakeItem:function(t,i){var a=e.getService("fake-item"),n=a.create();g[t]=n;var o=n.init(i);o?this.appendFakeItemToItemList(n.getElement()):this.completeFakeItem(t)},updateFakeItem:function(e,t,i){e in g?g[e].updateItem(t):i&&this.createFakeItem(e,t)},completeFakeItem:function(e){e in g&&(g[e].destroy(),delete g[e])},replaceFakeItem:function(e,t,i,a){if(a){e in g||this.createFakeItem(e,t);var n=$(i).addClass("newly-uploaded-item");$(g[e].getElement()).replaceWith(n)}this.completeFakeItem(e),this.renderItem(t.item)},renderItem:function(e){e&&e.render({init:!1,file_view:!0,force_render_tags:!0,force_render_classes:!0})},resetFakeItems:function(){for(var e in g)g.hasOwnProperty(e)&&g[e].destroy();g={}}}}),Box.Application.addModule("item-description",function(e){"use strict";function t(e){return e.replace(/(\n\r|\n)/g,"<br/>")}function i(){var e=n.get("Canvas");return e.current_folder}function a(){s.text()==s.attr("placeholder")?o.removeClass(h):o.addClass(h)}var n,o,s,r,l,d=$t("Click to edit","edit_in_place_prompt"),c="edit_in_place edit_in_place_inline",_="edit_in_place",m="placeholder",h="actions";return{messages:["x-folderchangeafter","x-searchbefore"],init:function(){n=e.getService("v5"),o=$(e.getElement()),s=o.find(".item_description"),r=e.getService("dom"),l=r.getData(o[0],"type")},onmessage:function(t,a){var n,s,r,d=e.getService("nav-state");switch(t){case"x-folderchangeafter":if("folder-description"!==l)break;n=i(),n&&n.id>1?(s=n.description,r=d.isFiles()&&n.permissions.rename,this.handleDescriptionDisplay(s,r)):o.hide();break;case"x-searchbefore":o.hide()}},bindEditInPlace:function(){s.attr({"data-hover":"tooltip","aria-label":d}),s.attr("data-behavior",_),s.addClass(c),s.data("callback",a)},unbindEditInPlace:function(){s.removeAttr("data-hover aria-label"),s.removeAttr("title"),s.removeAttr("data-behavior"),s.removeClass(c),s.removeData("callback")},bindPlaceholder:function(){s.text(s.attr("placeholder")),s.addClass(m),o.removeClass(h)},unbindPlaceholder:function(){s.removeClass(m),o.addClass(h)},setDescription:function(i){var a=e.getService("strings");s.html(t(a.getHyperlinkedString($.box.escapeHTML(i))))},handleDescriptionDisplay:function(e,t){e&&e.length?t?this.showEditableDescription(e):e&&e.length?this.showDescription(e):o.hide():o.hide()},showDescription:function(e){var t=o.attr("data-max-description-width");this.setDescription(e),this.unbindEditInPlace(),this.unbindPlaceholder(),o.show(),t&&this.setDescriptionWidth(t)},showEditableDescription:function(e){var t=o.attr("data-max-description-width");this.setDescription(e),this.bindEditInPlace(),e&&e.length?this.unbindPlaceholder():this.bindPlaceholder(),o.show(),t&&this.setDescriptionWidth(t)},setDescriptionWidth:function(e){o.width(e)}}});
//# sourceMappingURL=/js/section_templ_box_files.js.map